(function(){var h=window.dust;h.helpers=h.helpers||{};h.filters=h.filters||{};var c=1000,d=c*60,e=d*60,f=e*24,a=f*7,g=a*4,l=f*365,i=4,m=60,o=86400;var n={inNYear:"in 1 year",inNYears:"in {0} years",yearAgo:"1 year ago",yearsAgo:"{0} years ago",dueYearAgo:"Due 1 year ago",dueYearsAgo:"Due {0} years ago",inNMonth:"in 1 month",inNMonths:"in {0} months",monthAgo:"1 month ago",monthsAgo:"{0} months ago",dueMonthAgo:"Due 1 month ago",dueMonthsAgo:"Due {0} months ago",inNWeek:"in 1 week",inNWeeks:"in {0} weeks",weekAgo:"1 week ago",weeksAgo:"{0} weeks ago",dueWeekAgo:"Due 1 week ago",dueWeeksAgo:"Due {0} weeks ago",inNDay:"in 1 day",inNDays:"in {0} days",dayAgo:"1 day ago",daysAgo:"{0} days ago",dueDayAgo:"Due 1 day ago",dueDaysAgo:"Due {0} days ago",inNHour:"in 1 hour",inNHours:"in {0} hours",hourAgo:"1 hour ago",hoursAgo:"{0} hours ago",inNMinute:"in 1 minute",inNMinutes:"in {0} minutes",minuteAgo:"1 minute ago",minutesAgo:"{0} minutes ago",inNSecond:"in 1 second",inNSeconds:"in {0} seconds",secondAgo:"1 second ago",secondsAgo:"{0} seconds ago",justNow:"just now",dueToday:"Today",overdue:"overdue",setForDate:"set for {0}",everyMonth:"every month starting {0}",every3Months:"every 3 months starting {0}",everyWeek:"every week starting {0}",every6months:"every 6 months starting {0}",everyYear:"every year starting {0}",customInterval:"every {0} day{1} starting {2}"},b="{0}/{1}/{2}",j="{0}/{1}";var p={604800:n.everyWeek,2678400:n.everyMonth,8035200:n.every3Months,16070400:n.every6months,31536000:n.everyYear};function k(w,q,z){if(!w){return""}var y=w.split("\n"),v=0,B=[],x,A,r,t;for(var s=0,u=y.length;s<u;s++){if(y[s].length<=z){v++;B.push(y[s])}else{x=Math.ceil(y[s].length/z);if((v+x)<=q){v+=x;B.push(y[s])}else{A=q-v;v+=A;t=y[s].substring(0,A*z);r=y[s].substring(A*z).split(" ");if(r.length>1){B.push(t+r[0])}else{B.push(t)}}}if(v>=q){break}}return B.join("\n")}h.filters.formatRelationshipItemTime=function(v){var r=new Date(),q=v*c,u=n,w=r-q,s,t;if(w>0){if(s=Math.floor(w/l)){t=(s===1)?u.yearAgo:u.yearsAgo}else{return LI.timeFormat(q,n)}}else{w=Math.abs(w);if(s=Math.floor(w/l)){t=(s===1)?u.inNYear:u.inNYears}else{if(s=Math.floor(w/g)){t=(s===1)?u.inNMonth:u.inNMonths}else{if(s=Math.floor(w/f)){t=(s===1)?u.inNDay:u.inNDays}else{if(s=Math.floor(w/e)){t=(s===1)?u.inNHour:u.inNHours}else{if(s=Math.floor(w/d)){t=(s===1)?u.inNMinute:u.inNMinutes}else{if(s=Math.floor(w/c)){t=(s===1)?u.inNSecond:u.inNSeconds}else{t=u.justNow}}}}}}}return YAHOO.lang.substitute(t,{0:s})};h.filters.formatRelationshipDueDate=function(w){var q=new Date(),r=new Date(q),t=w*c,s=new Date(t),y=n,x,u,v;v=q-t;if(Math.abs(v)<=f&&r.getDate()===s.getDate()){return y.dueToday}else{if(v>0){if(u=Math.floor(v/l)){x=(u===1)?y.dueYearAgo:y.dueYearsAgo}else{if(u=Math.floor(v/g)){x=(u===1)?y.dueMonthAgo:y.dueMonthsAgo}else{if(u=Math.floor(v/f)){x=(u===1)?y.dueDayAgo:y.dueDaysAgo}else{x=y.dueToday}}}return YAHOO.lang.substitute(x,{0:u})}else{return h.filters.formatRelationshipItemTime(w)}}};h.filters.formatRelationshipDueDateInfo=function(w){var q=new Date(),r=new Date(q),t=w*c,s=new Date(t),y=n,x,u,v;v=q-t;if(Math.abs(v)<=f&&r.getDate()===s.getDate()){return y.dueToday}else{if(v>0){if(u=Math.floor(v/l)){x=y.overdue}else{if(u=Math.floor(v/g)){x=y.overdue}else{if(u=Math.floor(v/f)){x=y.overdue}else{x=y.overdue}}}return YAHOO.lang.substitute(x,{0:u})}else{return YAHOO.lang.substitute(y.setForDate,{0:h.filters.smartFormatRelationshipItemDate(w)})}}};h.filters.formatRecurringReminderDate=function(s){var q=s.interval,u=q/o,t="",r=p[q]||n.customInterval;if(u>1){t="s"}if(q in p){return YAHOO.lang.substitute(r,{0:h.filters.smartFormatRelationshipItemDate(s.start_date)})}else{return YAHOO.lang.substitute(r,{0:u,1:t,2:h.filters.smartFormatRelationshipItemDate(s.start_date)})}};h.filters.formatRelationshipItemDate=function(r){var q=new Date(r*c);return YAHOO.lang.substitute(b,{0:q.getMonth()+1,1:q.getDate(),2:q.getFullYear()})};h.filters.smartFormatRelationshipItemDate=function(t){var q=new Date(),r=t*c,s=new Date(r);if(q.getFullYear()===s.getFullYear()){return YAHOO.lang.substitute(j,{0:s.getMonth()+1,1:s.getDate()})}else{return YAHOO.lang.substitute(b,{0:s.getMonth()+1,1:s.getDate(),2:s.getFullYear()})}};h.helpers.isTruncationNeeded=function(u,v,t,x){if(x){var s=x.noOfLines||i,q=x.avgCharactersPerLine||m,r=k(x.content,s,q);if(x.content&&(r.length!==x.content.length)){try{return u.render(t.block,v.push({truncatedNote:r}))}catch(w){}}else{try{return u.render(t["else"],v)}catch(w){}}return u}};h.helpers.formatRelationshipNote=function(r,t,q,v){if(v){if(v.content!==undefined){try{var s=v.content.split("\n");return r.render(q.block,t.push({noteFragments:s}))}catch(u){}}return r}};h.helpers.truncateRelationshipHeaderTags=function(z,s,q,t){var B,A=0,w,u,r=25;if(t){B=t.tags;u=t.width;if(B&&B.length>1){w=B.length;for(var v=0,x=B.length;v<x;v++){A+=r+(B[v].name?B[v].name.length*8:0);if(A>=u){w=v;break}}try{return z.render(q.block,s.push({tags:B.slice(0,w),overflowTags:B.slice(w)}))}catch(y){}}else{if(B){try{return z.render(q.block,s.push({tags:B,overflowTags:[]}))}catch(y){}}}return z}};h.helpers.isReminderOverdueOrDueToday=function(z,s,r,w){var B,t,A,u,v,q=false,y=false;if(w&&w.dueDateInSeconds){t=new Date();u=new Date(t);B=w.dueDateInSeconds*c;v=new Date(B);A=t-B;q=(A>0);y=(Math.abs(A)<=f&&u.getDate()===v.getDate());if(q||y){try{return z.render(r.block,s)}catch(x){}}else{try{return z.render(r["else"],s)}catch(x){}}return z}};h.helpers.isRelationshipAddressEmpty=function(r,s,q,v){if(v&&v.field){var u=v.field;if(!u.address1&&!u.address2&&!u.city&&!u.state&&!u.zip){try{return r.render(q.block,s)}catch(t){}}else{try{return r.render(q["else"],s)}catch(t){}}return r}};h.helpers.companyInfoShouldHide=function(r,s,q,u){if(!u.company&&!u.title){try{return r.render(q.block,s)}catch(t){}}return r};h.helpers.companyAndTitleDisplay=function(r,s,q,t){return r.write(h.escapeHtml(((t.title)?t.title:"")+((t.title&&t.company)?" at ":"")+((t.company)?t.company.name:"")))};h.helpers.isEditable=function(r,s,q,u){if(!u.source||u.source.name.indexOf("LinkedIn")===-1){try{return r.render(q.block,s)}catch(t){}}return r}}());(function(d){var b=false,a=Array.prototype;previousFiber=d.Fiber;function f(i,h){var g;for(g in i){if(i.hasOwnProperty(g)){h[g]=i[g]}}}function e(){}e.extend=function(i){var h=this.prototype,g=i(h),j;function k(){if(!b&&typeof this.init==="function"){this.init.apply(this,arguments);delete this.init}}b=true;j=k.prototype=new this;b=false;f(g,j);j.constructor=k;k.__base__=h;k.extend=e.extend;return k};e.proxy=function(j,g){var h,k={},i;if(arguments.length===1){g=j;j=g.constructor.__base__}i=function(l){return function(){return j[l].apply(g,arguments)}};for(h in j){if(j.hasOwnProperty(h)&&typeof j[h]==="function"){k[h]=i(h)}}return k};function c(l,k,j){var h,g=args.length;for(h=0;h<g;h++){f(j[h](k),l)}}e.decorate=function(h){var k,l=h.constructor.__base__,j=a.slice.call(arguments,1),g=j.length;for(k=0;k<g;k++){f(j[k].call(h,l),h)}};e.mixin=function(k){var j,l=k.__base__,h=a.slice.call(arguments,1),g=h.length;for(j=0;j<g;j++){f(h[j](l),k.prototype)}};e.noConflict=function(){d.Fiber=previousFiber;return e};if(typeof module!=="undefined"){if(typeof module.setExports==="function"){module.setExports(e)}else{if(module.exports){module.exports=e}}}else{d.Fiber=e}})(this);$.throttle=function(c,d){var b,f,g,h,e,i;var a=_.debounce(function(){e=h=false},d);return function(){b=this;f=arguments;var j=function(){g=null;if(e){i=c.apply(b,f)}a()};if(!g){g=setTimeout(j,d)}if(h){e=true}else{h=true;i=c.apply(b,f)}a();return i}};$.debounce=function(c,e,b){var d,a;return function(){var i=this,h=arguments;var g=function(){d=null;if(!b){a=c.apply(i,h)}};var f=b&&!d;clearTimeout(d);d=setTimeout(g,e);if(f){a=c.apply(i,h)}return a}};(function(b){var a={};a.Event=function(c){return{_hook:function(){if(!this._$hook){this._$hook=$({})}return this._$hook},on:function(){var d=this._hook();d.on.apply(d,arguments)},off:function(){var d=this._hook();d.off.apply(d,arguments)},trigger:function(){var d=this._hook();d.trigger.apply(d,arguments)}}};b.Mixins=a})(window);(function(){var b={};this.tmpl=function a(e,d){e=e.trim();var c=!/\W/.test(e)?b[e]=b[e]||a(document.getElementById(e).innerHTML):new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+e.replace(/[\r\t\n]/g," ").replace(/'(?=[^%]*%>)/g,"\t").trim().split("'").join("\\'").split("\t").join("'").replace(/<%=(.+?)%>/g,"',$1,'").split("<%").join("');").split("%>").join("p.push('")+"');}return p.join('');");return d?c(d):c}})();(function(){var b={};this.tmplEscaped=function a(e,d){e=e.trim();var c=!/\W/.test(e)?b[e]=b[e]||a(document.getElementById(e).innerHTML):new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+e.replace(/[\r\t\n]/g," ").replace(/'(?=[^%]*%>)/g,"\t").trim().split("'").join("\\'").split("\t").join("'").replace(/<%=\|safe(.+?)%>/g,"',$1,'").replace(/<%=(.+?)%>/g,"',Connected.Utils.encodeHTML($1),'").split("<%").join("');").split("%>").join("p.push('")+"');}return p.join('');");return d?c(d):c}})();window.Broadcaster={$self:$({}),trigger:function(){this.$self.trigger.apply(this.$self,arguments)},on:function(){this.$self.on.apply(this.$self,arguments)},off:function(){this.$self.off.apply(this.$self,arguments)}};window.TagManagerBroadcaster=window.Broadcaster;(function(){var a={};a.Types={YOUR_DAY_PROMO:"contacts-daily-promo",INTEGRATE_SOURCE_PROMO:"contacts-sources-promo",RELATIONSHIP_COLLAPSE:"contacts-relationship-collapse",RELATIONSHIP_EXPAND:"contacts-relationship-expand",RELATIONSHIP_VIEW:"contacts-relationship-view",RELATIONSHIP_TAB_TOGGLE:"contacts-relationship-tab-toggle",RELATIONSHIP_INPUT_ACTION_TOGGLE:"contacts-relationship-input-action-toggle",RELATIONSHIP_SEE_MORE:"contacts-relationship-see-more",SEND_MESSAGE_STATUS_UPDATE_LIKE:"contacts-apps-send-message-status-update-like",SEND_MESSAGE_STATUS_UPDATE_COMMENT:"contacts-apps-send-message-status-update-comment",NEWS_ABOUT_NETWORK_WRONG_PERSON:"contacts-daily-people-news-feedback-wrong-person",NEWS_ABOUT_NETWORK_ARTICLE_LINK:"contacts-daily-people-news-article-link"};a.track=function(d,b){var c={pageKey:d,event_type:"pageViewEventType",trackingInfo:b};return $.ajax({url:"/contacts/api/trackings/",type:"POST",data:JSON.stringify([c]),cache:false})};window.EventsTracking=a}());(function(a,b){a.Contacts=b.extend(true,{Constants:{},Utils:{},UI:{},UIControls:{},App:{},API:{}},a.Contacts||{})})(window,window.jQuery);(function(e,c){e.Connected=e.Connected||{};var j=e.encodeURIComponent;var h=j("!'()*")!=="!'()*"?j:function h(){return j.apply(this,arguments).replace(/[!'()]/g,e.escape).replace(/\*/g,"%2A")};var g=(function(p){var q,m;var l={"\t":"\t","\r":"\r","\n":"\n","\u00a0":"&nbsp;","<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","\u007f":"&#xfffd;","\u2028":"&#x2028;","\u2029":"&#x2029;"};for(m=0;m<32;m++){q=String.fromCharCode(m);if(l[q]===p){l[q]="&#xfffd;"}}var n=/[\u0000-\u0008\u000b\u000c\u000e-\u001f\u00a0<>'"`\\\[\]+\-=.:(){};,\/&\u007f\u2028\u2029]/g;for(m=32;m<128;m++){q=String.fromCharCode(m);if(l[q]===p&&q.match(n)){l[q]="&#"+m+";"}}return function o(t){if(t===null||t===p){return""}var r=typeof(t);if(r==="number"||r==="boolean"){return t}else{if(r==="object"){return null}}return(t+"").replace(n,function(s){return l[s]})}}());var k={allowedTags:["A","AREA","AUDIO","B","BUTTON","BIG","BLOCKQUOTE","BR","CODE","DIV","FONT","FORM","H1","H2","H3","H4","H5","H6","HR","I","INPUT","IMG","LABEL","LI","MAP","MARQUEE","NOBR","OL","OPTGROUP","OPTION","P","PRE","Q","S","SELECT","SMALL","SOURCE","SPAN","STRIKE","STRONG","SUB","SUP","TABLE","TBODY","TD","TEXTAREA","TFOOT","TH","THEAD","TR","U","UL","VIDEO","WBR"],aliasAttributes:["rel","style","id","name","target","for","flashvars","classid","data","action","formaction","quality","scale","wmode","salign","background","allowfullscreen","allowscriptaccess","allownetworking","codebase"],allowedAttributes:["hreflang","checked","frameborder","border","scrolling","seamless","class","href","src","alt","title","type","method","height","width","value","cols","colspan","color","controls","coords","dir","disabled","enctype","hidden","label","loop","maxlength","multiple","pattern","preload","readonly","required","reversed","rows","rowspan","sandbox","spellcheck","usemap","data-\\w+","alias-\\w+","alias","typography"],urlAttributes:["src","href","action","formaction","poster"]};var f={allowedTags:k.allowedTags,aliasAttributes:null,allowedAttributes:["for","rel","target","action","id","name"].concat(k.allowedAttributes),urlAttributes:k.urlAttributes};var d=function(m){var l="[#/.?0-9]|&#x23;|&#35;|&#x2f;|&#47;|&#x2e;|&#46;|&#x3f;|&#63;|(?:mailto|http|ftp)|about:blank|data:image/(?:gif|jpg|jpeg|png);base64,|feed:https?://";return{allowedTagsRE:m.allowedTags===null?null:new RegExp("<(?=/?(?:"+m.allowedTags.join("|")+")(?:/?>|[ \\r\\n\\t][^<]*?>))","ig"),aliasAttributesRE:m.aliasAttributes===null?null:new RegExp("([ \\n\\t])("+m.aliasAttributes.join("|")+")(?=[ \\r\\n\\t]*=[ \\r\\n\\t]*['\"][^<]+?>)","ig"),allowedAttributesRE:m.allowedAttributes===null?null:new RegExp("([ \\n\\t](?:"+m.allowedAttributes.join("|")+")[ \\r\\n\\t]*)=(?=[ \\r\\n\\t]*['\"][^<]+?>)","ig"),urlAttributesRE:m.urlAttributes===null?null:new RegExp("([ \\n\\t](?:"+m.urlAttributes.join("|")+")[ \\r\\n\\t]*=[ \\r\\n\\t]*['\"][ \\r\\n\\t]*)(?![ \\r\\n\\t]*(:?"+l+"))","ig")}};var i=d(k);var b=function(l,m){l=l.replace(/\u0000/g,"&#xfffd;");l=l.replace(m.allowedTagsRE,"\u0000").replace(/<(\/?)(?=[a-z0-9]+[ \t\r\n>])/ig,"\u0000$1alias-").replace(/</g,"&lt;").replace(/\u0000/g,"<");if(m.aliasAttributesRE!==null){l=l.replace(m.aliasAttributesRE,"$1alias-$2")}l=l.replace(m.allowedAttributesRE,"$1\u0000").replace(/[=]/g,"&#61;").replace(/\u0000/g,"=");l=l.replace(m.urlAttributesRE,"$1./");return l};var a=(function(){var m,l=["January","February","March","April","May","June","July","August","September","October","November","December"],o=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],n={d:function(){return(m.getDate()<10?"0":"")+m.getDate()},D:function(){return o[m.getDay()].substring(0,3)},j:function(){return m.getDate()},l:function(){return o[m.getDay()]},N:function(){return m.getDay()+1},S:function(){return(m.getDate()%10===1&&m.getDate()!==11?"st":(m.getDate()%10===2&&m.getDate()!==12?"nd":(m.getDate()%10===3&&m.getDate()!==13?"rd":"th")))},w:function(){return m.getDay()},F:function(){return l[m.getMonth()]},m:function(){return(m.getMonth()<9?"0":"")+(m.getMonth()+1)},M:function(){return l[m.getMonth()].substring(0,3)},n:function(){return m.getMonth()+1},Y:function(){return m.getFullYear()},y:function(){return(""+m.getFullYear()).substr(2)},a:function(){return m.getHours()<12?"am":"pm"},A:function(){return m.getHours()<12?"AM":"PM"},g:function(){return m.getHours()%12||12},G:function(){return m.getHours()},h:function(){return((m.getHours()%12||12)<10?"0":"")+(m.getHours()%12||12)},H:function(){return(m.getHours()<10?"0":"")+m.getHours()},i:function(){return(m.getMinutes()<10?"0":"")+m.getMinutes()},s:function(){return(m.getSeconds()<10?"0":"")+m.getSeconds()},O:function(){return(-m.getTimezoneOffset()<0?"-":"+")+(Math.abs(m.getTimezoneOffset()/60)<10?"0":"")+(Math.abs(m.getTimezoneOffset()/60))+"00"},P:function(){return(-m.getTimezoneOffset()<0?"-":"+")+(Math.abs(m.getTimezoneOffset()/60)<10?"0":"")+(Math.abs(m.getTimezoneOffset()/60))+":"+(Math.abs(m.getTimezoneOffset()%60)<10?"0":"")+(Math.abs(m.getTimezoneOffset()%60))},T:function(){var q=m.getMonth();m.setMonth(0);var p=m.toTimeString().replace(/^.+ \(?([^\)]+)\)?$/,"$1");m.setMonth(q);return p},Z:function(){return -m.getTimezoneOffset()*60},r:function(){return m.toString()},U:function(){return m.getTime()/1000}};return function(q,t){var s="",p="";m=q;for(var r=0;r<t.length;r+=1){p=t.charAt(r);if(n[p]){s+=n[p]()}else{s+=p}}return s}})();e.Connected.Utils={queryStringAsObject:function(p){p=(p||e.location.search).substr(1);var l,n,o;if(p===""){return{}}this.queryStringAsObject.cache=this.queryStringAsObject.cache||{};n=this.queryStringAsObject.cache[p];if(n){return n}n={};l=p.split("&");if(l.length===0){return{}}for(var m=0;m<l.length;++m){o=l[m].split("=");n[o[0]]=decodeURIComponent(o[1].replace(/\+/g," "))}return n},csrfForAjax:function(){c(e.document).ajaxSend(function(m,n,l){n.setRequestHeader("X_CSRF_TOKEN",(LI.readCookie("JSESSIONID")||"").replace(/"/g,""))})},convertStringToType:function(m,l){if(l===Object||l===Array){return JSON.parse(m)}else{if(l===Number){return +m}else{if(l===Boolean){if(m==="true"){return true}else{if(m==="false"){return false}else{return null}}}else{return m}}}},getData:function(m,o){var t=c(m).get(0);if(!t){return null}var q=t.attributes,v,l,w,n,u,x,p={},s=o||{};if(t.nodeType!==1){return p}for(var r=0;r<q.length;r++){v=q[r];l=v.name;if(l.indexOf("data-")!==0){continue}w=t.getAttribute(l);x=jQuery.camelCase(l.substring(5));u=s[x]||String;n=Connected.Utils.convertStringToType(w,u);p[x]=n}return p},encodeHTML:g,encodeURIComponent:h,sanitizeHTML:function(l){return b(l,i)},getStaticUrl:function(l){return e.STATIC_URL+l},dateFormat:a};if(e.Contacts&&e.Contacts.Utils){e.Contacts.Utils=e.Connected.Utils}})(window,jQuery);(function(b,c){b.Contacts.Constants=c.extend(b.Contacts.Constants||{},{HOME_URL:"/contacts/",CONTACT_URL:"{0}/contact/?id={1}",CONTACT_MERGE_URL:"/contacts/services/apps/linkedin_search/select_linkedin_profile/?linkedin_profile={0}&contact={1}&auth-name={2}&auth-value={3}",CONTACT_DELETE:"/contacts/api/contacts/{0}/?method=delete",CONTACT_LINKEDIN_SEARCH_URL:"/contacts/api/linkedin_search/?name={0}",GHOST_PROFILE_IMAGE_SMALL:"https://static.licdn.com/scds/common/u/images/themes/katy/ghosts/person/ghost_person_60x60_v1.png",URL_PROTOCOL_REGEX:/^https?:\/\//i,URL_REGEX:/^https?:\/\/([a-z0-9\-]+)\.*?[a-z0-9\-]+\.[a-z]{2,6}.*$/i,EMAIL_REGEX:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,5}/i});var a=Connected.Utils.getData("#lnkd-contacts-base-page-config")||{};var e;if(!/^https/.test(a.urlPath)){e=a.urlPath?a.urlPath.split(":").join("s:"):a.urlPath}var d={CONNECTED_SERVICE_PREFIX:a.connectedServicePrefix||"/contacts",STATIC_URL:a.staticUrl||"",URL_PATH:a.urlPath||"",SECURE_URL_PATH:e||"",FACEBOOK_PERMISSIONS:a.facebookPermissions||"",FACEBOOK_API_KEY:a.facebookApiKey||"",DEFAULT_IMAGE_URL:a.defaultImageUrl||"https://static.licdn.com/scds/common/u/images/themes/katy/ghosts/person/ghost_person_100x100_v1.png",MIN_VIEWPORT_WIDTH:"1224",IS_REDESIGN_ENABLED:a.isRedesignEnabled||""};b.Contacts.Constants=c.extend(b.Contacts.Constants,d)})(window,jQuery);(function(c,b){var a=Fiber.extend(function(){var f;var e=['<div id="dialog-wrapper-contacts" class="dialog-v2 contacts-dialog">','  <div class="dialog-mask dialog-task-modal">','    <div class="dialog-window">','      <div class="dialog-title">','        <span class="dialog-close"></span>','        <h3 class="title"></h3>',"      </div>",'      <div class="dialog-body" style="">','        <div class="dialog-message" style="display: none;"></div>','        <div class="dialog-content">',"        </div>",'        <div class="dialog-actions" style="display: none;"></div>',"      </div>","    </div>","  </div>","</div>"].join("");var d={template:e,isModal:true,title:""};return{init:function(h,g){this.$el=h;this.options=c.extend({},d,g);this.$dialog=c(this.options.template);this.$dialog.hide();this.$dialogWindow=this.$dialog.find(".dialog-window");this.$closeButton=this.$dialog.find("span.dialog-close");this.$content=this.$dialog.find(".dialog-content");this.$title=this.$dialog.find(".dialog-title .title");this.$title.text(this.options.title);this.appendContent();this.$closeButton.on("click",c.proxy(this.close,this));this.isAttached=false},appendContent:function(){this.$content.append(this.$el);this.$el.show()},attachToBody:function(){if(this.isAttached){return}this.$dialog.appendTo(c(document.body));this.isAttached=true},open:function(){if(f&&f!==this){f.close()}f=this;if(this.isOpen){return}this.isOpen=false;this.attachToBody();this.$dialog.show();var g=this.$dialogWindow.width();this.$dialogWindow.css({"margin-left":-g/2+2});this.trigger("opened")},close:function(g){f=null;this.$dialog.hide();this.isOpen=false;this.trigger("closed",g)}}});Fiber.mixin(a,Mixins.Event);b.UIControls=c.extend({},b.UIControls,{Dialog:a});if(b.Contacts){b.Contacts.UIControls=b.UIControls}})(jQuery,window);(function(d,e){var a=".alert-control";var c=['<div class="alert <%= type %>" role="alert">'," <%= message %>",' <a href="#" class="js-dismiss dismiss" title="dismiss this message" role="button">Dismiss this message</a>',"</div>"].join("");var f={type:"notice",message:"Alert!"};var b=Fiber.extend(function(){return{template:function(g){return tmpl(c,g)},init:function(g){this.options=e.extend({},f,g||{});this.$el=this.options.el?e(this.options.el):e(this.template(this.options));this.$el.on("click."+a,e.proxy(this.onClose,this))},close:function(h){if(h&&h.preventDefault){h.preventDefault()}var g=this.$el||e(this).closest(".alert");g.trigger("alert-closed").remove().off(a)},appendTo:function(g){return this.$el.appendTo(g)},prependTo:function(g){return this.$el.prependTo(g)}}});Fiber.mixin(b,Mixins.Event);(function(){var g=0;var h={};e.fn.alert=function(){var j=Array.prototype.slice.call(arguments);var k=(typeof j[0]==="string")?j[0]:null;var i=(typeof j[0]==="object"&&j.length===1)?j[0]:{};return this.each(function(){var m=e(this);if(!k){g+=1;m.data("alert-id","t"+g);h["t"+g]=(new b(e.extend({el:this},i)))}var l=h[m.data("alertId")];if(typeof k==="string"&&l){l[k].apply(l,j.slice(1));if(k==="close"){delete h[m.data("alertId")]}}})}}());d.UIControls=e.extend({},d.UIControls,{Alert:b});e(document).on("click",".js-dismiss",b.prototype.close)})(window,window.jQuery);(function(d,c){var b=Fiber.extend(function(){var g;var f="contactsTip";var e={debounce:300,placement:"bottom",offsetTop:0,offsetLeft:0,anchor:null,zIndex:null,type:"hover"};return{_isInsideTip:false,_isShowing:false,init:function(i,h){this.options=d.extend({},e,h);this.$anchor=this.options.anchor;this.$tip=i;this.$tip.appendTo(d(document.body));this.$arrow=i.find(".tip");this.bindEvents();this._isShowing=false},bindEvents:function(){switch(this.options.type){case"hover":this.$anchor.on("mouseleave."+f,d.proxy(this.onAnchorMouseLeave,this));this.$tip.on("mouseenter."+f,d.proxy(this.onMouseEnter,this));this.$tip.on("mouseleave."+f,d.proxy(this.onMouseLeave,this));break;case"click":d(document.body).on("click."+f,d.proxy(this.onDocumentClick,this));break}},show:function(){if(g&&g!==this){g.hide()}g=this;var h=this.calculatePosition();this.$tip.css(h);this.$tip.show();this._isShowing=true;if(this.options.zIndex&&!isNaN(parseInt(this.options.zIndex,10))){this.$tip.css("zIndex",this.options.zIndex)}},hide:function(){if(this.$tip){this.$tip.hide();this._isShowing=false}},toggle:function(){if(this._isShowing){this.hide()}else{this.show()}},isInsideTip:function(){return this._isInsideTip},isShowing:function(){return this._isShowing},onDocumentClick:function(){this.hide()},onMouseEnter:function(){this._isInsideTip=true},onMouseLeave:function(){this._isInsideTip=false;this.onAnchorMouseLeave()},onAnchorMouseLeave:function(){setTimeout(d.proxy(function(){if(!this._isInsideTip){this.hide()}},this),this.debounce)},calculatePosition:function(){var o=this.$anchor.offset(),i=this.$anchor.outerWidth(),h=this.$tip.outerWidth(),n=this.$tip.outerHeight(),j=this.$arrow.outerHeight();var m,k,l;switch(this.options.placement){case"bottom":if(o.left+h>d(document).width()-h){m=o.left+i-h+this.options.offsetLeft;l=o.top+i+this.options.offsetTop;k=h-i/2}else{l=o.top+i+this.options.offsetTop;m=o.left+this.options.offsetLeft;k=i/2}this.$arrow.css({left:k});break;case"top":m=o.left+i-i/2-h/2;l=o.top-this.options.offsetTop-n-j;break;default:l=o.top+i+this.options.offsetTop;m=o.left+this.options.offsetLeft}return{left:m,top:l}},destroy:function(){g=undefined;this.hide();this.$anchor.off(f);this.$tip.off().remove();this.options=this.$anchor=this.$tip=this.$arrow=undefined}}});var a=Fiber.extend(function(){var e="contactsToolTip";return{tip:null,_tipMoveDelay:500,_tipMouseLeaveProcessing:false,$content:null,template:['<div class="tooltip" role="tooltip" tabindex="-1" class="hidden">','<div class="callout-content"></div>','<i class="callout-arrow tip"></i>',"</div>"].join(""),$template:null,init:function(f){this.options=f;this.$el=d(this.options.el);this.$template=d(this.template);this.$content=this.$template.find(".callout-content");if(this.$el.attr("title")){this.$el.data("tooltip-content",this.$el.attr("title")).removeAttr("title")}this.bindEvents()},bindEvents:function(){this.$el.on("mouseenter."+e,d.proxy(this.onTriggerMouseEnter,this));this.$el.on("mouseleave."+e,d.proxy(this.onTriggerMouseLeave,this));this.$el.on("click."+e,d.proxy(this.onTriggerMouseClick,this))},getContent:function(){return this.$el.data("tooltipContent")},onTriggerMouseEnter:function(f){this.$content.text(this.getContent());this.tip=new UIControls.Tip(this.$template,{anchor:this.$el,placement:"top",zIndex:this.options.zIndex});this.tip.show()},onTriggerMouseLeave:function(){if(this._tipMouseLeaveProcessing){return}this._tipMouseLeaveProcessing=true;setTimeout(d.proxy(function(){if(this.tip&&!this.tip.isInsideTip()){this.removeTip()}},this),this._tipMoveDelay)},onTriggerMouseClick:function(){this.removeTip()},removeTip:function(){if(!this.tip){return}this.tip.destroy();this.tip=undefined;this._tipMouseLeaveProcessing=false},destroy:function(){this.tip=this.$content=this.$template=undefined;this.$el.off(e)}}});(function(){var e=0;var f={};d.fn.tooltip=function(){var h=Array.prototype.slice.call(arguments);var i=(typeof h[0]==="string")?h[0]:null;var g=(typeof h[0]==="object"&&h.length===1)?h[0]:{};return this.each(function(){var k=d(this);if(!i){e+=1;k.data("tooltip-id","t"+e);f["t"+e]=(new a(d.extend({el:this},g)))}var j=f[k.data("tooltipId")];if(typeof i==="string"&&j){j[i].apply(j,h.slice(1));if(i==="destroy"){delete f[k.data("tooltipId")]}}})}}());c.UIControls=d.extend(c.UIControls,{Tip:b,ToolTip:a})})(jQuery,window);(function(a,b){var c=Fiber.extend(function(){var d=40;var e=66;return{$el:null,$content:null,template:'<div class="contacts-loader"><span></span></div>',frame:0,init:function(){this.$el=b(this.template);this.$content=this.$el.find("span");return this},show:function(){this.$el.show();this._animate();return this},hide:function(){this.$el.hide();return this},_animate:function(){if(!this.$el.is(":visible")){this.frame=0;return}this.$content.css("top",(this.frame*-d)+"px");this.frame=(this.frame+1)%12;setTimeout(b.proxy(this._animate,this),e);return this},appendTo:function(f){this.$el.appendTo(f);return this},prependTo:function(f){this.$el.prependTo(f);return this}}});a.UIControls=b.extend({},a.UIControls,{Loader:c})})(window,window.jQuery);(function(a){window.Connected=window.Connected||{};a.extend(Connected,{UI:{}});a(function(){Connected.UI.Notification=(function(){var c=5000;return{show:function(f){var g="";var e=null;f=Connected.Utils.sanitizeHTML(f);switch(arguments.length){case 2:var d=arguments[1];if(typeof d==="boolean"){e=d}else{g=d}break;case 3:g=arguments[1];e=arguments[2];break}LI.injectAlert(f,g,null,false,true);if(e||(e===null)){window.setTimeout(Connected.UI.Notification.hide,c)}},hide:function(){LI.removeAlert()}}})()});function b(d,f,e){d=(window.url_path||"")+(window.CONNECTED_SERVICE_PREFIX||"")+d;var c=a.Deferred();a.ajax({url:d,type:e||"GET",dataType:"html",data:f,cache:false}).success(function(g){c.resolve(g)}).error(function(){c.reject()});return c.promise()}(function(){var e={addEnter:function(i,g){var f=i.find(g.actionButton).filter(":visible:first"),h=i.find("input[type=text], input[type=textbox], input[type=password]").filter(":visible");if(f.length===0||h.length===0){return}h.off("keydown.dialog").on("keydown.dialog",function(j){if(j.keyCode===CONSTANTS.ENTER_KEYCODE&&!j.shiftKey){f.trigger("click");return false}})}};function d(g){var f=g.find("input[tabindex=1],textarea[tabindex=1]").not(":input[type=button]").filter(":visible:first");if(f){setTimeout(function(){f.first().focus()},0)}}Connected.UI.Dialog={instance:null};var c=UIControls.Dialog.extend(function(g){var f=g.appendContent;return{appendContent:function(){},attachToBody:function(){g.attachToBody.apply(this,arguments);f.apply(this,arguments)}}});Connected.UI.Dialog.open=function(j,i){var f=a.Deferred(),k=(typeof j==="string"),i=a.extend({requestData:{},requestType:"GET",enter:false,actionButton:"input.save-button:visible, input.btn-linkedin:visible"},i);function g(m){var p=m.find("a.cancel-button");var o=m.find("h4.title");var n=new c(m,{title:o.text()});o.hide();n.open();n.on("closed",function(q){Connected.UI.Dialog.instance=null;q=q||{};if(k){m.remove()}});n.resize=function(){};Connected.UI.Dialog.instance=n;n.actionButton=m.find(i.actionButton);if(p.length){p.on("click",function(q){q.preventDefault();if(Connected.UI.Dialog.instance){Connected.UI.Dialog.instance.close()}})}return n}if(k){var h=false,l=setTimeout(function(){if(!h){Contacts.UI.Loader.show()}},150);b(j,i.requestData,i.requestType).done(function(m){h=true;Contacts.UI.Loader.hide();clearTimeout(l);f.resolve(g(a(a.trim(m))))}).fail(function(m){f.reject(m)})}else{f.resolve(g(a(j)))}return f.promise()};Connected.UI.Dialogs={openHelp:function(){return Connected.UI.Dialog.open("/services/apps/reminders/help_div/")},openLinkedInSearchHelp:function(){return Connected.UI.Dialog.open("/services/apps/linkedin_search/help_div/")},openAddContact:function(){return Connected.UI.Dialog.open("/services/add_contact_div/",{enter:true})},openMSOutlookEWSConnect:function(){return Connected.UI.Dialog.open("/services/msoutlook_ews_connect_div/",{enter:true})},openGoogleVoiceConnect:function(){return Connected.UI.Dialog.open("/services/gvoice_connect_div/",{enter:true})},openFacebookBirthdaysConnect:function(){return Connected.UI.Dialog.open("/services/facebook_birthdays_connect_div/",{enter:true})},openYahooCalendarConnect:function(){return Connected.UI.Dialog.open("/services/yahoo_calendar_connect_div/",{enter:true})},openConnectDialog:function(f){return Connected.UI.Dialog.open(String.formatWithUriEscape("/services/{0}_connect_div/",f),{enter:true})},openGoogleContactsSettings:function(){return Connected.UI.Dialog.open("/settings/gcontacts/",{enter:true})},openGoogleCalendarSettings:function(){return Connected.UI.Dialog.open("/settings/gcalendar/",{enter:true})},openSettingsDialog:function(f){return Connected.UI.Dialog.open(String.formatWithUriEscape("/settings/{0}/",f),{enter:true})},openImportContacts:function(f){return Connected.UI.Dialog.open(String.formatWithUriEscape("/services/import_contacts_file_div/?type={0}",f),{enter:true})},openSyncNow:function(g,f){return Connected.UI.Dialog.open(String.formatWithUriEscape("/services/sync_now_div/?integration_details_div={0}&service={1}",g,f))},openMessage:function(g,f){if(f){return Connected.UI.Dialog.open(String.formatWithUriEscape("/services/send_message_div/?message_type={0}&contact_id={1}",f,g),{enter:true})}else{return Connected.UI.Dialog.open(String.formatWithUriEscape("/services/send_message_div/?contact_id={0}",g),{enter:true})}},openMessageByEngageEventId:function(f,g){if(f){return Connected.UI.Dialog.open(String.formatWithUriEscape("/services/send_message_div/?&engage_event_id={0}",f),{enter:true,actionButton:g})}},openJobChangeMessage:function(h,g,i,f){return Connected.UI.Dialog.open(String.formatWithUriEscape("/services/send_message_div/?message_type={0}&contact_id={1}&thread_id={2}&update_time={3}",g,h,i,f),{enter:true})},openWorkAnniversary:function(i,h,k,g,f,j){return Connected.UI.Dialog.open(String.formatWithUriEscape("/services/send_message_div/?message_type={0}&contact_id={1}&thread_id={2}&update_time={3}&number_of_years={4}&since_month={5}",h,i,k,g,f,j),{enter:true})},openUpcomingTripMessage:function(j,h,g,i,f){return Connected.UI.Dialog.open(String.formatWithUriEscape("/services/send_message_div/?message_type={0}&contact_id={1}&start_date={2}&end_date={3}&destination={4}",h,j,g,i,f),{enter:true})},openNewsAboutNetworkMessage:function(i,g,h,f){return Connected.UI.Dialog.open(String.formatWithUriEscape("/services/send_message_div/?message_type={0}&contact_id={1}&source={2}&url={3}",g,i,h,f),{enter:true})},openEvernote:function(f){return Connected.UI.Dialog.open(String.formatWithUriEscape("/services/evernote_div/?evernote_id={0}",f))},openInteractionMessage:function(h,g,f){return Connected.UI.Dialog.open(String.formatWithUriEscape("/services/get_message_div/?source={0}&id={1}&contact_id={2}",g,f,h))},openCalendarEvent:function(f){return Connected.UI.Dialog.open(String.formatWithUriEscape("/services/get_calendar_event_div/?id={0}",f))},openRemoveIntegration:function(f,g){return Connected.UI.Dialog.open("/services/remove_integration_div/",{requestData:{service:f,remove_associated_data:g},requestType:"POST"})},openLocationChange:function(j,g,f,i,h,k){return Connected.UI.Dialog.open(String.formatWithUriEscape("/services/send_message_div/?message_type={0}&contact_id={1}&update_time={2}&new_location={3}&old_location={4}",g,j,f,i,h),{enter:true,actionButton:k})},openLinkedInConnect:function(f,g){return Connected.UI.Dialog.open(String.formatWithUriEscape("/services/linkedin_connect_div/?contact_id={0}",f),{enter:true,actionBUtton:g})},openLinkedInConnectWithoutContactId:function(h,f,g){return Connected.UI.Dialog.open("/services/linkedin_connect_div_without_contact_id/",{requestData:{invitee_linkedin_id:h,auth_name:f,auth_value:g},enter:true})}}})();(function(){var f={},c=1;Connected.UI.WindowProxy=(function(){function j(){var k=a(this);this.close=function(m,l){if(f[m]){f[m].resolve(l)}}}return new j()})();function d(m,l,k,n){var j=a.Deferred();++c;f[c]=j;m=m.replace(/{HASH}/g,c).replace(/{URL}/g,window.CONNECTED_SERVICE_PREFIX).replace(/{PROTO_HOST}/g,String.format("{0}://{1}",window.location.protocol.replace(":",""),window.location.host));window.open(m,l," height = "+k+", width = "+n);return j.promise()}var e="settings_integrations/";var i=e+"%3Fhash_index={HASH}";var h=e+"%3Fgmail_error=1";var g=e+"%3Fhash_index={HASH}%26result=denied";Connected.UI.IntegrationWindows={openLinkedInConnect:function(){return d("{URL}/oauth/linkedin/?success_redirect=settings_integrations/?hash_index={HASH}&failure_redirect=settings_integrations/","Integrate",200,425)},openTwitterConnect:function(){return d("{URL}/oauth/twitter/?app=contacts&success_redirect=settings_integrations/%3Fhash_index={HASH}&failure_redirect=settings_integrations/%3Fhash_index={HASH}%26result=denied","Integrate",450,450)},openGoogleContactsConnect:function(){return d("{URL}/oauth/gcontacts/?success_redirect=settings_integrations/?hash_index={HASH}&failure_redirect=settings_integrations/","Integrate",600,950)},openGoogleCalendarConnect:function(){return d("{URL}/oauth/gcalendar/?success_redirect=settings_integrations/?hash_index={HASH}&failure_redirect=settings_integrations/","Integrate",600,950)},openEvernoteConnect:function(){return d("{URL}/oauth/evernote/?success_redirect=settings_integrations/?hash_index={HASH}&failure_redirect=settings_integrations/","Integrate",225,525)},openConstantContactConnect:function(){return d("{URL}/oauth/constant_contact/?success_redirect=settings_integrations/?hash_index={HASH}&failure_redirect=settings_integrations/","Integrate",500,500)},openAWeberConnect:function(){return d("{URL}/oauth/aweber/?success_redirect=settings_integrations/?hash_index={HASH}&failure_redirect=settings_integrations/","Integrate",600,850)},openGmailConnect:function(){return d("{URL}/oauth/gmail/?success_redirect=settings_integrations/?hash_index={HASH}&failure_redirect=settings_integrations/%3Fgmail_error=1","Integrate",600,950)},openGoogleConnect:function(){return d("{URL}/oauth/google/?success_redirect=settings_integrations/?hash_index={HASH}&failure_redirect=settings_integrations/%3Fgmail_error=1","Integrate",600,950)},openTripItConnect:function(){return d("{URL}/oauth/tripit/?success_redirect=settings_integrations/?hash_index={HASH}&failure_redirect=settings_integrations/","Integrate",600,850)},openYahooContactsConnect:function(){return d(String.format("{URL}/oauth/yahoo_contacts/?success_redirect={0}&failure_redirect={1}",i,g),"Integrate",600,950)},openFacebookConnect:function(j){return Connected.UI.Facebook.login(true,j)},open:function(k,p){function j(q){return function(){var r=a.Deferred();q().done(function(s){s.__currentDfd=r});return r.promise()}}function o(q){return function(){var r=a.Deferred();q().done(function(s){s.on("closed",function(u,t){if(t&&t.action==="done"){r.resolve()}})});return r.promise()}}function n(q){return function(){var r=a.Deferred();q();return r.promise()}}var m={linkedin:Connected.UI.IntegrationWindows.openLinkedInConnect,twitter:Connected.UI.IntegrationWindows.openTwitterConnect,gcontacts:Connected.UI.IntegrationWindows.openGoogleContactsConnect,gcalendar:Connected.UI.IntegrationWindows.openGoogleCalendarConnect,evernote:Connected.UI.IntegrationWindows.openEvernoteConnect,google:Connected.UI.IntegrationWindows.openGoogleConnect,email:Connected.UI.IntegrationWindows.openGmailConnect,gmail:Connected.UI.IntegrationWindows.openGmailConnect,tripit:Connected.UI.IntegrationWindows.openTripItConnect,yahoo:Connected.UI.IntegrationWindows.openYahooContactsConnect,yahoo_calendar:o(Connected.UI.Dialogs.openYahooCalendarConnect),facebook:function(){return Connected.UI.IntegrationWindows.openFacebookConnect(!!p)},mailchimp:o(Connected.UI.Dialogs.openMailChimpConnect),constant_contact:Connected.UI.IntegrationWindows.openConstantContactConnect,aweber:Connected.UI.IntegrationWindows.openAWeberConnect,facebook_birthdays:o(Connected.UI.Dialogs.openFacebookBirthdaysConnect),outlook_ews:o(Connected.UI.Dialogs.openMSOutlookEWSConnect),gvoice:o(Connected.UI.Dialogs.openGoogleVoiceConnect)};var l=["linkedin_csv","yahoo_csv","mac_address_book_vcard","msoutlook_mac","msoutlook_csv"];a.each(l,function(r,q){m[q]=n(function(){Connected.UI.Dialogs.openImportContacts(q)})});return m[k]()}}})();a(function(){var f=a(document.body),c=a(".wrapper-dropdown-list > ul > li"),e=a("#page"),h=c.offset()?c.offset().top:0;function d(k){k.stopImmediatePropagation();var o=a(this),j=o.find("ul"),n=o.scrollTop(),m=j.outerHeight(),i=a(window).height(),l=!!o.parents("#subheader_bulk_actions")[0];c=a(".wrapper-dropdown-list > ul > li");c.each(function(){var p=a(this);if(p[0]!==o[0]){if(p.hasClass("selected")){window.TagManagerBroadcaster.trigger("dropdown.blur",{el:p.find("ul")});p.removeClass("selected")}}});if(!a(k.target).is(".wrapper-dropdown-list input")&&!a(k.target).parent("li").is(".new_tag_link")){if(o.hasClass("selected")){window.TagManagerBroadcaster.trigger("dropdown.blur",{el:j})}else{window.TagManagerBroadcaster.trigger("dropdown.selected",{outOfViewport:(h-n+m>i),height:m,isBulk:l,bulkHeight:i-h-50,el:j})}if((a(k.target).closest("li.recurring-option")).data("li-value")!=="custom date"){o.toggleClass("selected")}}else{window.TagManagerBroadcaster.trigger("dropdown.selected",{outOfViewport:(h-n+m>i),height:m,isBulk:l,bulkHeight:i-h-50,el:j});o.addClass("selected")}}function g(i){c.each(function(){var j=a(this);if(j.hasClass("selected")){j.removeClass("selected");window.TagManagerBroadcaster.trigger("dropdown.blur",{el:j.find("ul")})}})}f.on("click",g);f.on("click",".wrapper-dropdown-list > ul > li",d)});(function(){var d=null,c=a(document.body);Connected.UI.CommandMenu=function(g,f){var e=this,h;this.options=a.extend({preventDefault:true},f);this.$anchor=g;this.$menu=g;this.$self=h=a(this);this.items={};this.count=0;this.optionsCount=0;this.$menu.find("li").each(function(){var l=a(this),k=l.data("item-type")||"option";e.items[l.data("item-id")]={id:l.data("item-id"),node:l,text:l.find("a").text(),type:k};e.count++;if(k==="option"){e.optionsCount++}});function j(k){k.stopImmediatePropagation();if(e.isVisible){e.hide();return}e.show();c.on("click.command-menu-close",function(){e.hide()})}function i(l){var n,m=a(l.target);if(m.is('input[type="checkbox"]')){n="itemchecked"}else{if(e.options.preventDefault){l.preventDefault()}n="itemclicked"}var k=e.items[a(this).data("item-id")];k=a.extend({event:l},k);h.trigger(n,k)}this.$menu.on("click","li",i)};Connected.UI.CommandMenu.templates={item:'<li data-item-id="{0}" data-item-name="{1}" data-item-type="option"><div class="checkbox-div"><input type="checkbox" /><label>&nbsp;</label></div><a href="#">{1}</a></li>'};Connected.UI.CommandMenu.prototype={removeItem:function(e){if(this.items[e]){if(this.items[e].type==="option"){this.optionsCount--;if(this.optionsCount===0){this.$menu.find(".separator").removeClass("separator")}}this.items[e].node.remove();delete this.items[e];this.count--}},addItem:function(j,i){var g=i?i:Connected.UI.CommandMenu.templates.item;var f=a(String.formatWithHtmlEscape(g,j.id,j.text));var h;var e=this.$menu.find('li[data-item-type="setting"]');if(e.length===0){this.$menu.prepend(f)}else{e.first().before(f)}this.items[j.id]={id:j.id,text:j.text,type:j.type||"option",node:f};h=f.next();if(h){h.addClass("separator")}this.count++;this.optionsCount++},updateItem:function(g){var f=this;var h=function(){var m=f.items[this.id];if(m!==undefined){delete f.items[this.id];f.items[this.newId]=m;var i=f.items[this.newId];i.id=this.newId;i.text=this.text;var p=i.node;p[0].attributes["data-item-id"].value=this.newId;p[0].attributes["data-item-name"].value=this.text;p.data("item-id",this.newId);p.data("item-name",this.text);if(p.find("input")[0]!==undefined&&p.find("input")[0].attributes.id){var n=p.find("input")[0].attributes.id.value;p.find("input")[0].attributes.id.value=n.replace(/item-.*$/,"item-"+this.newId)}var o=p.find("a");o.text(this.text);if(this.hasOwnProperty("glyph")){var k=a('<span class="glyph tag"></span>');o.prepend(k)}var j=o[0].attributes.href.value;var l=j.replace(/tag=.*$/,"tag="+this.newId);o[0].attributes.href.value=l}};var e=function(){var i=a("#profile_command_tag_menu").find('[data-item-id="'+this.id+'"]');if(i.length>0){i[0].attributes["data-item-id"]=this.newId;i.attr("data-item-id",this.newId);i.data("item-id",this.newId)}};if(g.hasOwnProperty("newId")){h.call(g);e.call(g)}else{if(this.items[g.id]){this.items[g.id].node.find("a").text(g.text);this.items[g.id].text=g.text}}},show:function(){},hide:function(){}}})();(function(){var c=false;Connected.UI.Facebook={load:function(){var d=a.Deferred();if(c){return d.resolve().promise()}window.fbAsyncInit=function(){window.FB.init({appId:window.FACEBOOK_API_KEY,status:true,cookie:true,oauth:true,xfbml:true});d.resolve()};(function(f){var e,g="facebook-jssdk";if(f.getElementById(g)){return}e=f.createElement("script");e.id=g;e.async=true;e.src="//connect.facebook.net/en_US/all.js";f.getElementsByTagName("head")[0].appendChild(e)}(document));c=true;return d.promise()},login:function(e,h){if(e===undefined||e===null){e=true}var d=a.Deferred(),g=d.promise(),f={scope:window.FACEBOOK_PERMISSIONS};if(h){f.auth_type="reauthenticate"}FB.login(function(i){if(i.authResponse){d.resolve()}else{d.reject()}},f);if(e){g=g.pipe(Connected.API.Integrations.saveFacebookCredentials)}return g},addFriend:function(d,e){FB.ui({method:"friends.add",id:e},function(f){if(f.action===true){Connected.UI.Notification.show("Sending invite...","progress",false);Connected.API.Connect.facebook(d,e).done(function(){location.reload()}).fail(function(g){Connected.UI.Notification.show(g,"error")})}})},postToWall:function(e){var d={method:"feed",to:e};FB.ui(d,function(f){if(f.action===true){Connected.UI.Notification.show("Your message has been sent...","success",false)}})}}})();(function(){var c=new window.UIControls.Loader();a(function(){c.appendTo(document.body)});window.Contacts.UI.Loader={show:a.proxy(c.show,c),hide:a.proxy(c.hide,c)}})()})(jQuery);(function(c){function d(e){return c.map(e,function(f){return f.id+"|"+f.type})}window.Connected=window.Connected||{};c.extend(Connected,{API:{}});c(document).ajaxSend(function(g,j,f){function i(l){var n=document.location.host,o=document.location.protocol,m="//"+n,k=o+m;return(l===k||l.slice(0,k.length+1)===k+"/")||(l===m||l.slice(0,m.length+1)===m+"/")||!(/^(\/\/|http:|https:).*/.test(l))}function h(k){return(/^(GET|HEAD|OPTIONS|TRACE)$/.test(k))}if(!h(f.type)&&i(f.url)){var e=(LI.readCookie("csrftoken")||"").replace(/"/g,"");j.setRequestHeader("X-CSRFToken",e)}});function a(f,h,g){var e=c.Deferred();f=(window.url_path||"")+(window.CONNECTED_SERVICE_PREFIX||"")+f;function i(j){if(j.status==="success"){e.resolve(j)}else{e.reject(j.status_details||"An unspecified error occured")}}c.ajax({url:f,type:g||"GET",data:h,cache:false,success:i,error:i});return e.promise()}var b="/services/edit_contact_data/";Connected.API.Contact={sendEmail:function(f,e){return a("/services/send_message/",{contact_id:f,type:"Email",email_server_id:e.serverId,email:e.email,cc:e.cc,bcc:e.bcc,subject:e.subject,message:e.message},"POST")},sendLinkedInMessage:function(g,e,f){return a("/services/send_message/",{contact_id:g,type:"LinkedIn Message",subject:e,message:f},"POST")},sendTweet:function(f,e){return a("/services/send_message/",{contact_id:f,type:"Twitter Mention",message:e},"POST")}};Connected.API.Contacts={create:function(e){return a("/services/add_contact/",e,"POST")},hide:function(e){return a("/services/hide_contacts/",{contact_ids:e.join(",")},"POST")},remove:function(e){return c.ajax({url:String.formatWithUriEscape("/contacts/api/contacts/{0}/?method=delete",e),type:"POST",cache:false})},unhide:function(e){return a("/services/unhide_contacts/",{contact_ids:e.join(",")},"POST")},tag:function(f,e){return c.ajax({url:String.formatWithUriEscape("/contacts/api/contacts/{0}/tags/",e),data:JSON.stringify({tag_ids:f instanceof Array?f:[f]}),type:"POST",cache:false})},getContacts:function(f,e){return a("/services/get_search_contacts/",{existing_contact_id:f,filter:e})},getSearchSourceContacts:function(e){return a("/services/contact_editor_search_source_contacts/",{contact_id:e})},getMergedContactsData:function(e){return a("/services/contact_editor_merged_contact_data/",{contact_id:e})},merge:function(e){if(e instanceof Array){return a("/services/merge_contacts/",{contact_ids:e.join(",")},"POST")}return a("/services/merge_contact/",{existing_merged_id:e.existingMergedId,existing_ids:e.existingIds.join(","),new_ids:e.newIds.join(","),search_merged_id:e.searchMergedId||"",search_ids:e.searchIds.join(","),existing_merged_contact_data_ids:d(e.existingMergedContactDataIds).join(";"),new_merged_contact_data_ids:d(e.newMergedContactDataIds).join(";"),search_merged_contact_data_ids:d(e.searchMergedContactDataIds).join(";")},"POST")},mergePairs:function(e){return a("/services/merge_pairs/",{merge_pairs:e.join(";")},"POST")}};Connected.API.Tag={setName:function(f,e){return a(String.formatWithUriEscape("/api/tags/{0}/?method=put",f),JSON.stringify({name:e}),"POST")},remove:function(e){return a(String.formatWithUriEscape("/api/tags/{0}/?method=delete",e),{},"POST")}};Connected.API.Tags={create:function(f){var e=c.Deferred();a("/api/tags/",JSON.stringify({name:f}),"POST").done(function(g){e.resolve(g.tag_id)}).fail(function(g){e.reject(g)});return e.promise()}};Connected.API.Evernote={remove:function(e){return a("/services/evernote_delete/?evernote_id="+e,{},"POST")}};Connected.API.Locations={merge:function(e,f){return a("/services/merge_locations/",{location_names:JSON.stringify(e),primary_location:f},"POST")}};Connected.API.Companies={merge:function(f,e){return a("/services/merge_companies/",{company_ids:f.join(","),primary_companyId:e},"POST")}};Connected.API.Calendars={save:function(e){return a("/services/gcalendar/save_calendars/",{calendars:e.join(",")})}};Connected.API.Connect={linkedin:function(e){return a("/services/apps/linkedin_search/connect_linkedin_profile/",e,"POST")},facebookBirthday:function(e){return a("/services/facebook_birthdays_connect/",{url:e},"POST")},yahooCalendar:function(e){return a("/services/yahoo_calendar_connect/",{url:e},"POST")},googleVoice:function(f,e){return a("/services/gvoice_connect/",{gvoice_email:f,gvoice_password:e},"POST")}};Connected.API.Preferences={setTimezone:function(f,e){return a("/update_timezone/",{timezone_name:f,override:e},"POST")}};Connected.API.Integrations={getIntegrationDetails:function(e){return a("/services/integration_details/",{service:e})},closePromoSettings:function(e){return a("/services/closed_contacts_page_promo_settings/",{promo_type:e})},saveFacebookCredentials:function(){return a("/services/save_facebook_credentials/")},verifyServiceCredentials:function(e){return a("/services/verify_service_credentials/",{service:e})},verifyServiceCredentialsSimplified:function(f){var e=c.Deferred();Connected.API.Integrations.verifyServiceCredentials(f).done(function(g){var h=true;c.each(g.details,function(){if(!this.valid){h=false;return false}});if(!h){e.reject()}else{e.resolve()}});return e.promise()},setGoogleContactsType:function(e){return a("/services/gcontacts/save_contacts/",{contacts:e})},emailResolve:function(e){return a("/services/zeppelin_email_resolve/",{email:e})}};Connected.API.Integrations.MSOutlook={setCredentials:function(f,h,e,g){return a("/services/msoutlook_ews_connect/",{msoutlook_email:f,msoutlook_username:h,msoutlook_password:e,msoutlook_webmail_url:g},"POST")}};Connected.API.Reminder={setComplete:function(e){return a("/services/apps/reminders/complete_reminder/",{reminder_id:e})}};Connected.API.EngageEvent={_setResolved:function(f,e){return c.ajax({url:"/contacts/api/engagements/",type:"POST",data:JSON.stringify({engage_event_id:f,dismiss_event:e}),cache:false})},setComplete:function(e){return this._setResolved(e,false)},setDismissed:function(e){return this._setResolved(e,true)}}})(jQuery);LI.define("StyledDropdownLC");LI.StyledDropdownLC=function(b){var j=b,m=null,r=null,l=[],g=null,h=null,a=false,o=0,f=-1,e=0,n=0,i=null,c,q,p,s,d;m=Y$("select",j,true);g=Y$("span.label",j,true);r=Y$("ul",j,true);if(!r){r=document.createElement("ul");j.appendChild(r)}if(!g){i=['<span class="label">',"<span>",m.options[m.selectedIndex].text,"</span>","</span>"].join("");p=LI.domify(i);j.insertBefore(p,m)}g=Y$("span.label span",j,true);YDom.addClass(j,"styled-dropdown");function k(){var z=":false;",y,u,v=m.options,x=r.firstChild,w=0,t;if(!a){if(YAHOO.env.ua.ie&&YAHOO.env.ua.ie<7){h=document.createElement("iframe");h.src="javascript"+z;j.appendChild(h)}n=m.options.length;for(w=0;w<n;w++){y=v[w];u=document.createElement("li");u.innerHTML="<a>"+LI.htmlEncode(y.text)+"</a>";YDom.addClass(u,y.className+" option");if(y.selected&&o===0){g.innerHTML=LI.htmlEncode(y.text);o=w;e=w}if(w===0){YDom.addClass(u,"first")}else{if(w+1===t){YDom.addClass(u,"last")}}if(x){r.insertBefore(u,x)}else{r.appendChild(u)}}l=r.getElementsByTagName("li");for(w=0,t=l.length;w<t;w++){l[w]._index=w}a=true}}d=function(){var u=YDom.getRegion(r),y=YDom.getRegion(g.parentNode),x,w,v,t;x=[y.left,y.bottom];YDom.addClass(j,"open");YDom.setXY(r,x);if(YAHOO.env.ua.ie&&YAHOO.env.ua.ie<7){if(u){h.style.height=u.height+"px";h.style.width=u.width+"px"}YDom.setXY(h,YDom.getXY(r))}w=YDom.getElementsByClassName("highlighted","li",r);for(v=0,t=w.length;v<t;v++){YDom.removeClass(w[v],"highlighted")}YDom.addClass(l[m.selectedIndex],"highlighted")};s=function(){YDom.removeClass(j,"open");YDom.removeClass(Y$(".lu-state-active",r,true),"lu-state-active")};c=function(u){u=u||window.event;var x=YEvent.getTarget(u);if(u.type==="click"){if(u.preventDefault){u.preventDefault()}if(u.type==="click"&&YDom.getAncestorByClassName(x,"styled-dropdown")&&(!YDom.hasClass("label")&&!YDom.getAncestorByClassName(x,"label"))){if(x.nodeName.toLowerCase()!=="li"){x=YDom.getAncestorByTagName(x,"li");YDom.addClass(x,"lu-state-active");if(!x){return}}o=x._index;if(o<n){m.selectedIndex=o}}if(YDom.hasClass(x,"option")){q(o)}}if(!YDom.hasClass(j,"open")){g.innerHTML=m.options[m.selectedIndex].text;for(var w=g.className.split(" "),t=w.length,v=0;v<t;v++){if(w[v].indexOf("styled-dropdown-select-")===0){YDom.removeClass(g,w[v])}}YDom.addClass(g,"styled-dropdown-select-"+m.options[m.selectedIndex].getAttribute("data-li-styled-dropdown-class"))}};q=function(t){e=t;f=t;s()};k();YEvent.on(g,"click",function(t){if(YDom.hasClass(j,"open")){s();c(t)}else{d()}});YEvent.on(r,"click",c)};(function(){LI.define("RelationshipLoader");var a="relationship-list",c="relationship-items",h="relationship-summary",l="profile-action-tab",i="contact-info",j="contact-unsave-dialog",b="full_top_card_contact_info",e="Twitter",k=20,d=100,g={FULL:"full",TRUNCATED:"truncated",MINIMIZED:"minimized"},f={NOT_SAVED:"not_saved",MINIMIZED:"minimized",TRUNCATED:"truncated",MAXIMIZED:"maximized",RELATIONSHIP:"relationship",CONTACT_INFO:"contact_info"};LI.RelationshipLoader=function(o,n){var m=this,p='<div class="relationship-header full-top-card-unsaved"><div class="full-top-card-unsaved-save"></div><div class="full-top-card-unsaved-public-profile"></div></div>';n=n||{};this.$el=$(o);this.setConnectedParams(n);this.url="/contacts/api/relationship";this.contactUrl="/contacts/api/contacts/";this.contactFields=["name","emails_extended","birthday","phone_numbers","sites","addresses","company","title","location","ims","profiles","twitter","wechat","display_sources"];this.profileId=n.profileId;this.contactId=n.contactId;this.staticUrl=n.staticUrl;this.isFullTopCard=($("#wrapper.premium-profile").length>0)?true:false;if(this.isFullTopCard&&!this.contactId){this.$el.append(p)}this.loaded=false;this.contactLoaded=false;this.$topCardActions=$(".profile-card-extras .profile-actions");this.$topCardContactInfo=$("#contact-info-section");this.$saveToContacts=$(".save-to-contacts");this.$relationshipSummary=this.$topCardActions.find(".relationship-summary");this.$showMoreInfo=this.$topCardActions.find(".show-more-info");this.$unsaveForm=$("#unsave-from-contacts");this.$saveForm=$("#save-to-contacts");this.$topCardMenu=this.$unsaveForm.parents("dl.connect-menu");this.$unsaveSeparator=this.$topCardMenu.find(".unsave-from-contacts-separator");this.$saveSeparator=this.$topCardMenu.find(".save-to-contacts-separator");this.$headerContainer=this.$el.find(".relationship-header");this.addTopCardActionEvents();if(this.isFullTopCard){this.$el.addClass("full-top-card");this.$el.prependTo($("#profile"));this.$el.show();this.$topCardActions.hide();if(this.contactId){this.collopsed=false;this.toggleTopCardMenuActions(true);this.loadRelationship()}else{this.$saveToContacts=this.$saveToContacts.clone();this.$saveToContacts.appendTo(this.$headerContainer.find(".full-top-card-unsaved-save"));this.showPublicProfileLink();this.renderContactInfoFromProfileDOMWhenFullTopCard();this.toggleTopCardMenuActions(false);this.track(window.EventsTracking.Types.RELATIONSHIP_VIEW,{state:f.NOT_SAVED})}}else{this.$topCardActions.css("display","table");if(this.contactId){this.toggleProfileButtons(false);this.loadRelationship();dust.render(h,this.content,function(r,q){m.$topCardActions.addClass("minimized");m.$relationshipSummary.html(q)});this.toggleTopCardMenuActions(true)}else{this.$topCardActions.css("display","table");this.track(window.EventsTracking.Types.RELATIONSHIP_VIEW,{state:f.NOT_SAVED});this.toggleTopCardMenuActions(false)}}if(this.$saveToContacts.length){this.bindEvents()}this.markContactAsSaved(Boolean(this.contactId));this.$showMoreInfo.click($.proxy(this.handleTopCardContactInfoClick,this))};LI.RelationshipLoader.prototype.showPublicProfileLink=function(n){var m=this.$headerContainer.find(".full-top-card-unsaved-public-profile");var q=document.getElementsByClassName("view-public-profile"),r;if(q.length>0){r=q[0].innerHTML}if(r){var o='<a href="http://'+r+'" class="view-public-profile">'+r+"</a>",p=$(o);m.append($("<span></span>"));m.append(p);$("#relationship-public-profile").removeClass("no-contact-info-data");$(".view-public-profile").on("click",function(s){window.location="http://"+r})}};LI.RelationshipLoader.prototype.hasContactInfoInProfileTopCard=function(m){var n=m.find("tr"),o=false;n.each(function(p){if(!$(this).hasClass("no-contact-info-data")){o=true}});return o};LI.RelationshipLoader.prototype.renderContactInfoFromProfileDOMWhenFullTopCard=function(n){var m=$("#internet-presence-table").clone(),u=$('<div id="relationship-contact-info-section" class="more-info" data-li-template="contact_info" style="display: block;">'),p='<a href="#" class="card-tab connected-tab contacts-tab full-top-card-contact-info"><span class="icon contact"></span><span class="contact">Contact Info</span></a>',q='<div class="edit-collapse-module ajax-form"><div id="contact-container" class="contact-container"></div></div>',s=false;if(this.hasContactInfoInProfileTopCard(m)){this.$fullTopCardContactInfoTab=$(p);this.$headerContainer.append(this.$fullTopCardContactInfoTab);this.$fullTopCardContactForm=$(q);this.$headerContainer.after(this.$fullTopCardContactForm);m.addClass("internet-presence-table");m.removeAttr("id");m.find(".twitter-presence th")[0].style.cssText=document.defaultView.getComputedStyle($("#internet-presence-table").find(".twitter-presence th")[0],"").cssText;m.find(".www-presence  th")[0].style.cssText=document.defaultView.getComputedStyle($("#internet-presence-table").find(".www-presence th")[0],"").cssText;u.append(m);this.$el.height(31);var r=this.$fullTopCardContactForm.find("#contact-container");r.css("min-height","0");r.show();this.$fullTopCardContactForm.find("#contact-container").html(u);var o=this;this.$fullTopCardContactInfoTab.on("click",function(){if(s){$(this).removeClass("selected");o.$el.animate({height:"31px"},d)}else{$(this).addClass("selected");o.$el.animate({height:"100%"},d)}s=!s});if(this.profileId>0&&!this.$el.find(".wechat-presence").hasClass("no-contact-info-data")){this.initWeChat()}}};LI.RelationshipLoader.prototype.initWeChat=function(){var n=this.$el.find("#wechat-view"),q=$("#top-card").find("#wechat"),m=q.data("qr2-relationship-url"),o=m?m:q.data("qr2-url"),p=n.find(".username");p.click(function(r){r.preventDefault();new LI.ChatIn.QR2(p,o)})};LI.RelationshipLoader.prototype.renderContactInfoWhenFullTopCard=function(y){var z=fs.payload("top_card"),s=z&&z.content,p=s&&s.ContactInfo,n=p&&p.contact_info,w='<a href="#" class="card-tab connected-tab contacts-tab full-top-card-contact-info"><span class="icon contact"></span><span class="contact">Contact Info</span></a>',v='<div class="edit-collapse-module ajax-form"><div id="contact-container" class="contact-container"></div></div>',m=false;if(n&&n.hasContactInfo){this.$fullTopCardContactInfoTab=$(w);this.$headerContainer.append(this.$fullTopCardContactInfoTab);this.$fullTopCardContactForm=$(v);this.$headerContainer.after(this.$fullTopCardContactForm);var o=n.IMs,u=[];if(o){for(var r=0;r<o.length;r++){if(o[r]&&o[r].type==="weixin"){u.push(o[r])}}}var q={wechat:u,websites:n.websites,twitterAccounts:n.twitterAccounts},x=this;this.$el.height(31);dust.render(b,q,function(A,t){var B=x.$fullTopCardContactForm.find("#contact-container");B.css("min-height","0");B.show();x.$fullTopCardContactForm.find("#contact-container").html(t)});this.$fullTopCardContactInfoTab.on("click",function(){if(m){$(this).removeClass("selected");x.$el.animate({height:"31px"},d)}else{$(this).addClass("selected");x.$el.animate({height:"100%"},d)}m=!m})}};LI.RelationshipLoader.prototype.setConnectedParams=function(m){if(!window.CONNECTED_SERVICE_PREFIX&&m.servicePrefix){window.CONNECTED_SERVICE_PREFIX=m.servicePrefix}};LI.RelationshipLoader.prototype.track=function(n,m){if(window.EventsTracking){window.EventsTracking.track(n,m)}};LI.RelationshipLoader.prototype.markContactAsSaved=function(m){this.$saveToContacts.toggleClass("saved",m);this.$showMoreInfo.toggleClass("relationship-contact",m)};LI.RelationshipLoader.prototype.addTopCardActionEvents=function(){this.$saveForm.submit($.proxy(this.handleTopCardMenuSaveAction,this));this.$unsaveForm.submit($.proxy(this.handleTopCardMenuUnSaveAction,this))};LI.RelationshipLoader.prototype.handleTopCardMenuSaveAction=function(m){var n=this.$saveForm.attr("action");this.$topCardMenu.hide();this.handleSaveAction(n);return false};LI.RelationshipLoader.prototype.handleTopCardMenuUnSaveAction=function(m){this.showUnsaveConfirmationDialog();return false};LI.RelationshipLoader.prototype.showUnsaveConfirmationDialog=function(){var r=this.$el,s=this.$unsaveForm.find("input"),q=s.data("action"),p=(q==="relationship-unsave-from-contacts"),o=this.getFirstName(),n=$("#unsave-confirm-dialog"),m=this;if(n.length){n.remove()}dust.render(j,{isContact:p,firstName:o},function(u,t){r.append(t);m.createUnsaveConfirmationDialog(p,o)})};LI.RelationshipLoader.prototype.createUnsaveConfirmationDialog=function(q,n){var m=$("#unsave-confirm-dialog"),p=m.find(".unsave-actions"),o;if(q){o=n?"Remove {0} from Contacts":"Remove from Contacts"}else{o=n?"Remove {0} as a connection":"Remove connection"}this.unsaveConfirmDialog=new UIControls.Dialog(m,{title:String.format(o,n)});this.unsaveConfirmDialog.open();p.click($.proxy(this.handleUnsaveDialogAction,this))};LI.RelationshipLoader.prototype.handleUnsaveDialogAction=function(m){var n=$(m.target);m.preventDefault();if(n.closest(".unsave-action").length||n.closest(".remove-action").length){$("#unsave-confirm-dialog").addClass("form-submit-processing");(new Relationship()).unsaveFromContact(this.contactId).done($.proxy(function(){this.markContactAsUnSaved();location.reload()},this)).fail($.proxy(this.handleUnsaveError,this))}else{if(n.closest(".cancel-action").length){this.unsaveConfirmDialog.close()}}};LI.RelationshipLoader.prototype.handleUnsaveError=function(m){$("#unsave-confirm-dialog").removeClass("form-submit-processing");LI.injectAlert(m,"error",null,false,true)};LI.RelationshipLoader.prototype.unsaveFromContact=function(n){var m=$.Deferred();function o(p){if(p.status==="ok"){m.resolve(p)}else{m.reject(p.status_details||"An unspecified error occurred")}}$.ajax({url:n,type:"POST",cache:false,success:o,beforeSend:function(p){p.setRequestHeader("X-IsAJAXForm","1")}});return m.promise()};LI.RelationshipLoader.prototype.markContactAsUnSaved=function(){this.$saveToContacts.toggleClass("saved",false);this.$showMoreInfo.toggleClass("relationship-contact",false);if(this.$showMoreInfo.hasClass("saved-contact-tab")){this.$showMoreInfo.remove()}this.$el.hide();this.$relationshipSummary.html("");if(this.isFullTopCard){this.$topCardActions.hide()}else{this.$topCardActions.css("display","table")}this.toggleProfileButtons(true);this.contactId=null;this.contactLoaded=false;this.toggleTopCardMenuActions(false);if(this.unsaveConfirmDialog){this.unsaveConfirmDialog.close();$("#unsave-confirm-dialog").removeClass("form-submit-processing")}};LI.RelationshipLoader.prototype.bindEvents=function(){this.$saveToContacts.click($.proxy(this.handleClickEvent,this));this.$relationshipSummary.click($.proxy(this.onSummaryClick,this));if(!this.contactId){this.saveToContactsTooltip=new LI.BalloonCallout(this.$saveToContacts[0],{width:"auto",id:"save-to-contacts-tooltip",orientation:"bottom",type:"tooltip-callout",offsetX:0,offsetY:10})}};LI.RelationshipLoader.prototype.onSummaryClick=function(){if(!this.$el.is(":visible")){this.showRelationshipModule()}};LI.RelationshipLoader.prototype.handleClickEvent=function(m){var n;m.preventDefault();if(!this.contactId){n=this.getSaveAction($(m.target));this.handleSaveAction(n)}else{this.showRelationshipModule(m);this.selectTab("relationship");this.track(window.EventsTracking.Types.RELATIONSHIP_EXPAND,{tab:f.RELATIONSHIP})}};LI.RelationshipLoader.prototype.getSaveAction=function(m){var n=m.hasClass("target")?m:m.parents("div.save-to-contacts"),o=n.find("a"),p=o.data("li-action");return p};LI.RelationshipLoader.prototype.handleTopCardContactInfoClick=function(m){if(this.contactId){m.preventDefault();this.selectTab("contacts");this.showRelationshipModule(m);this.track(window.EventsTracking.Types.RELATIONSHIP_EXPAND,{tab:f.CONTACT_INFO})}};LI.RelationshipLoader.prototype.selectTab=function(o){var r=this.$headerContainer.find("."+o+"-tab"),p=this.$headerContainer.find(".card-tab"),n=this.$el.find(".relationship-container"),m=this.$el.find(".contact-container");p.removeClass("selected");r.addClass("selected");var q=r.hasClass("relationship-tab");n.toggle(q);m.toggle(!q);if(!q){this.loadContactInfo()}this.$el.toggleClass("contact-details",!q);if(window.Broadcaster){window.Broadcaster.trigger("relationship.tab.selected",{name:o})}};LI.RelationshipLoader.prototype.handleSaveAction=function(n){var m=this;if(n!==undefined){this.saveToContacts(n).done(function(o){if(o.status==="ok"){m.loadRelationship(g.TRUNCATED);m.markContactAsSaved(true);m.toggleTopCardMenuActions(true);m.hideContactInfoDrawer()}}).fail(function(){LI.injectAlert("Unable to save contact","error",null,false,true)})}else{if(this.loaded){this.$el.show()}}};LI.RelationshipLoader.prototype.hideContactInfoDrawer=function(){this.$topCardContactInfo.hide()};LI.RelationshipLoader.prototype.toggleTopCardMenuActions=function(m){this.$unsaveSeparator.toggle(m);this.$unsaveForm.toggle(m);this.$saveForm.toggle(!m);this.$saveSeparator.toggle(!m)};LI.RelationshipLoader.prototype.showRelationshipModule=function(m){this.toggleRelationshipModule(true,true)};LI.RelationshipLoader.prototype.animateFullTopCardExpansion=function(){var m=this;this.$el.animate({height:"100%"},d,$.proxy(this.doneFullTopCardExpansion,this))};LI.RelationshipLoader.prototype.animateFullTopCardCollapsing=function(){this.$el.animate({height:"31px"},d,$.proxy(this.doneFullTopCardCollapsing,this))};LI.RelationshipLoader.prototype.doneFullTopCardCollapsing=function(){var m=this.$headerContainer.find(".card-tab");m.removeClass("selected");m.one("click",$.proxy(this.animateFullTopCardExpansion,this));this.collopsed=true;this.$minimizeBtn.addClass("closed");this.$minimizeBtn.off();this.$minimizeBtn.one("click",function(){$(".relationship-tab").trigger("click")});this.$el.addClass("collapsed")};LI.RelationshipLoader.prototype.doneFullTopCardExpansion=function(){this.collopsed=false;this.$minimizeBtn.removeClass("closed");this.$el.removeClass("collapsed")};LI.RelationshipLoader.prototype.toggleRelationshipModule=function(m,p){var n=this.$topCardActions,o=this.$el;if(this.isFullTopCard){if(!p){if(m){this.$el.css("height","100%");this.doneFullTopCardExpansion()}else{this.$el.height(31);this.doneFullTopCardCollapsing()}}else{if(m){this.animateFullTopCardExpansion()}else{this.animateFullTopCardCollapsing()}}}else{if(!p){o.toggle(m);this.toggleProfileButtons(!m);n.toggleClass("minimized",!m)}else{if(m){this.animateExpansion()}else{this.animateCollapsing()}}}};LI.RelationshipLoader.prototype.animateExpansion=function(){var o=this.$topCardActions,n=o.position().top,p=this.$el,m=p.find(".edit-collapse-module");this.toggleProfileButtons(false);m.hide();p.show();m.slideDown(d)};LI.RelationshipLoader.prototype.animateCollapsing=function(){var p=this.$topCardActions,o=p.position().top,q=this.$el,m=q.find(".edit-collapse-module"),n=this;m.slideUp(d,function(){q.hide();n.toggleProfileButtons(true);p.addClass("minimized");p.css("top","auto")})};LI.RelationshipLoader.prototype.minimize=function(n){var o=this.$relationshipSummary,m=this;if(this.content){if(!this.isFullTopCard){dust.render(h,this.content,function(q,p){o.html(p);m.toggleRelationshipModule(false,n)})}else{m.toggleRelationshipModule(false,n)}if(n){this.track(window.EventsTracking.Types.RELATIONSHIP_COLLAPSE,{});if(window.Broadcaster){window.Broadcaster.trigger("relationship.minimized")}}}else{m.toggleRelationshipModule(false,n)}this.createMissingContactTab()};LI.RelationshipLoader.prototype.createMissingContactTab=function(){var o=this.$saveToContacts,p=this.$topCardActions,m,n=this;if(!this.$topCardActions.find("span.contact").length){dust.render(l,{},function(r,q){o.after(q);n.$showMoreInfo=p.find(".show-more-info");n.$showMoreInfo.click(m)})}};LI.RelationshipLoader.prototype.saveToContacts=function(n){var m=$.Deferred();function o(p){if(p.status==="ok"){m.resolve(p)}else{m.reject(p.status_details||"An unspecified error occurred")}}$.ajax({url:n,type:"POST",cache:false,success:o,beforeSend:function(p){p.setRequestHeader("X-IsAJAXForm","1")}});return m.promise()};LI.RelationshipLoader.prototype.loadRelationship=function(n){var m=fs.payload("profile_v2_relationship");if(m&&m.contact_id){this.loaded=true;this.setRelationshipData(m);this.contactId=m.contact_id;this.setContainers();this.handleDisplayMode(m)}else{this.loaded=false;this.fetch().done($.proxy(this.handleFetchedContent,this,n))}};LI.RelationshipLoader.prototype.handleFetchedContent=function(o,n){var p=this.$el,m=this;if(n.status==="success"){this.setRelationshipData(n);this.contactId=n.contact_id;n.displayMode=n.display;dust.render(a,n,function(r,q){p.html(q);m.$el.css("height","auto");LI.Controls.parseFragment(p[0]);m.setContainers();if(o!==undefined){n.display=o}m.handleDisplayMode(n);if(m.saveToContactsTooltip){m.saveToContactsTooltip.destroy()}})}};LI.RelationshipLoader.prototype.setContainers=function(){var m=this.$el;this.$relationshipItems=m.find(".relationship-items");this.$contactContainer=m.find(".contact-container");this.$progressIndicator=m.find(".relationship-progress");this.$editCollapseModule=m.find(".edit-collapse-module");this.$minimizeBtn=m.find(".minimize");this.$headerContainer=m.find(".relationship-header")};LI.RelationshipLoader.prototype.handleDisplayMode=function(m){var p=this.$el,o=this.$topCardActions,n;if(m.display===g.FULL||m.display===g.TRUNCATED){this.toggleProfileButtons(false);p.show();n=(m.display===g.FULL)?f.MAXIMIZED:f.TRUNCATED;if(!this.relationshipTour&&m.startTour){this.initOnBoarding()}}else{this.minimize();if(!this.isFullTopCard){o.css("display","table")}n=f.MINIMIZED}this.track(window.EventsTracking.Types.RELATIONSHIP_VIEW,{state:n})};LI.RelationshipLoader.prototype.toggleProfileButtons=function(m){this.$saveToContacts.toggle(m);this.$showMoreInfo.toggle(m)};LI.RelationshipLoader.prototype.initOnBoarding=function(){};LI.RelationshipLoader.prototype.showRelationshipData=function(m){var n=this.$relationshipItems;dust.render(c,{relationshipList:m,static_url:this.staticUrl},function(p,o){n.html(o);LI.Controls.parseFragment(n[0]);n.show()})};LI.RelationshipLoader.prototype.viewMore=function(){var m=[];if(this.content&&this.content.full){m=this.content.full}this.showRelationshipData(this.getUpdatedContent(m));this.track(window.EventsTracking.Types.RELATIONSHIP_SEE_MORE,{})};LI.RelationshipLoader.prototype.viewLess=function(){var m=[];if(this.content&&this.content.truncated){m=this.content.truncated}this.showRelationshipData(this.getUpdatedContent(m))};LI.RelationshipLoader.prototype.getItemId=function(m){if(m.source_contact_id){id=m.type+"-"+m.source_contact_id;return id}return m.id||m.type};LI.RelationshipLoader.prototype.getUpdatedContent=function(p){var o=[],q,n;for(var m=0;m<p.length;m++){q=this.getItemId(p[m]);if(q==="source_contact_note"){n=p[m]}else{n=this.relationshipData[q]}if(n){o.push(n)}}return o};LI.RelationshipLoader.prototype.setRelationshipData=function(m){var o,p,q=m.full||[];this.relationshipData={};for(var n=0;n<q.length;n++){p=q[n];o=this.getItemId(p);this.relationshipData[o]=p}this.content=m};LI.RelationshipLoader.prototype.getRelationshipData=function(){return this.relationshipData};LI.RelationshipLoader.prototype.getContactInfo=function(){return this.contact};LI.RelationshipLoader.prototype.updateRelationshipData=function(m,n){this.relationshipData[m]=n;if(!this.content){return}if(n===null){this.removeRelationshipItem(m,this.content.full);this.removeRelationshipItem(m,this.content.truncated)}else{this.updateRelationshipItem(m,n,this.content.full);this.updateRelationshipItem(m,n,this.content.truncated)}};LI.RelationshipLoader.prototype.getItemIndex=function(o,r){var p=-1,s,q;for(var n=0,m=r.length;n<m;n++){q=r[n];s=this.getItemId(q);if(o===s){p=n;break}}return p};LI.RelationshipLoader.prototype.getContactTags=function(){var m=[];if(this.content&&this.content.contact_tags){m=this.content.contact_tags}return m};LI.RelationshipLoader.prototype.addContactTag=function(o,n){var m=this.content&&this.content.contact_tags;if(m){m.push({id:o,name:n})}};LI.RelationshipLoader.prototype.getFirstName=function(){var o=this.content,m=o&&o.contact_details,n="";if(m&&m.first_name){n=m.first_name}return n};LI.RelationshipLoader.prototype.updateContactTag=function(r,o){var n=this.content&&this.content.contact_tags,q=false;if(n){for(var p=0,m=n.length;p<m;p++){if(n[p].id===r){n[p].name=o;q=true;break}}if(!q){this.addContactTag(r,o)}}};LI.RelationshipLoader.prototype.removeContactTag=function(q,o){var n=this.content&&this.content.contact_tags;if(n){for(var p=0,m=n.length;p<m;p++){if(n[p].id===q){n.splice(p,1);break}}}};LI.RelationshipLoader.prototype.updateRelationshipItem=function(o,r,q){if(!q){return}var p=this.getItemIndex(o,q);if(r.type==="reminder"){for(var n=0,m=q.length;n<m;n++){if(q[n].recurring){q.splice(n,1);q.unshift(r);return}}}if(p!==-1){q[p]=r}else{if(r.type==="how_we_met"){q.push(r)}else{q.unshift(r)}}};LI.RelationshipLoader.prototype.removeRelationshipItem=function(m,o){if(!o){return}var n=this.getItemIndex(m,o);if(n!==-1){o.splice(n,1)}};LI.RelationshipLoader.prototype.buildUrl=function(){return this.url+"/"+this.profileId+"/"};LI.RelationshipLoader.prototype.buildContactInfoUrl=function(){return(this.contactUrl+"/"+this.contactId+"/?fields="+this.contactFields.join(",")).replace(/\/\//g,"/")};LI.RelationshipLoader.prototype.fetch=function(){var m=$.Deferred();function n(o){if(o.status==="success"){m.resolve(o)}else{m.reject(o.status_details||"An unspecified error occurred")}}$.ajax({url:this.buildUrl(),type:"GET",cache:false,success:n});return m.promise()};LI.RelationshipLoader.prototype.fetchContactInfo=function(){var m=$.Deferred();function n(o){if(o.status==="success"){m.resolve(o)}else{m.reject(o.status_details||"An unspecified error occurred")}}$.ajax({url:this.buildContactInfoUrl(),type:"GET",cache:false,success:n});return m.promise()};LI.RelationshipLoader.prototype.loadContactInfo=function(){if(!this.contactLoaded){this.$progressIndicator.show();this.fetchContactInfo().done($.proxy(this.renderContactInfo,this)).fail($.proxy(function(){this.$progressIndicator.hide()},this))}};LI.RelationshipLoader.prototype.renderContactInfo=function(o){var q=o;var r=this.$contactContainer;var n=this;function m(s){r.html(s)}function p(){LI.Controls.parseFragment(r[0]);n.setPublicProfile();n.checkContactInfoAvailability();r.find(".relationship-sources, .source-icons i").tooltip();n.$progressIndicator.hide();var s=n.$el.find("#wechat-view");if(n.profileId>0&&s.length){n.initWeChat()}}if(q.status==="success"){this.contactLoaded=true;this.contact=q;this.extractTwitterId(q);q.contact_data.emails=q.contact_data.emails_extended;delete q.contact_data.emails_extended;q.contact_data.sources=LI.RelationshipContactInfoHelpers.cleanAndFilterContactSources(q.contact_data.display_sources);delete q.contact_data.display_sources;q.static_url=this.staticUrl;q.contact_id=this.contactId;dust.render(i,q,function(t,s){if($("html").hasClass("ie7")){setTimeout(function(){m(s);setTimeout(function(){p()},1000)},2000)}else{m(s);p()}})}};LI.RelationshipLoader.prototype.setPublicProfile=function(){var m=$("#relationship-public-profile-link"),n=document.getElementsByClassName("view-public-profile"),o;if(n.length>0){o=n[0].innerHTML}if(o){m.html('<a href="http://'+o+'">'+o+"</a>");$("#relationship-public-profile").removeClass("no-contact-info-data")}};LI.RelationshipLoader.prototype.checkContactInfoAvailability=function(){LI.RelationshipContactInfoHelpers.checkForEmptyContactInfoRegions()};LI.RelationshipLoader.prototype.extractTwitterId=function(o){if(!o.contact_data){return}var s=o.contact_data,n=s&&s.twitter,p,r;if(!this.twitterRegExp){this.twitterRegExp=/^https?:\/\/(www\.)?twitter\.com\/(#!\/)?([^\/]+)(\/\w+)*$/i}for(var q=0,m=n.length;q<m;q++){p=n[q].url;r=p.match(this.twitterRegExp);if(r&&r.length>3){n[q].twitterId=r[3]}}};LI.RelationshipLoader.prototype.updateContactInfo=function(n,p){var q=this.contact,m=q&&q.contact_data,o=m&&m[n];if(typeof o!=="undefined"){if(Object.prototype.toString.call(o)==="[object Array]"){o.push(p)}else{m[n]=p}}};LI.RelationshipLoader.prototype.getContactField=function(n){var m=this.contact&&this.contact.contact_data;if(m){return m[n]}else{return null}}}());(function(){var v=200,G=200,K=65,J=15,m="view-more",H="view-less",C="/contacts/images/default_profile_image.png",j=220,M=200,n="/static",y="edit-follow-up",l="edit-note",r="edit-how-you-met",B="relationship-item",b="header-tags",k="delete-relationship-item-confirm",a="relationship",f=5000,p="1 week",w={NOTE:"note",HOW_WE_MET:"how_we_met",MESSAGE:"message",CALENDAR_EVENT:"calendar_event",REMINDER:"reminder",TAGS:"tags",CONNECTION_HISTORY:"connection_history",EVERNOTE:"evernote",SOURCE_CONTACT_NOTE:"source_contact_note",GET_DISPLAY_NAME:function(N){if(N===w.HOW_WE_MET){return"How you met"}if(N===w.NOTE){return"Note"}if(N===w.REMINDER){return"Reminder"}}},e={RELATIONSHIP:"relationship",CONTACT_INFO:"contact_info"},h={DAY:"day",WEEK:"week",MONTH:"month",THREE_MONTHS:"3 months",SIX_MONTHS:"6 months",YEAR:"1 year",RECURRING:"recurring",CUSTOM_DATE:"custom date"},g=1000,F=g*60,E=F*60,L=E*24,q=L*7,i=q*4,D=3*i,u=6*i,t=L*365,A=86400,z=604800,s=2678400,x=8035200,I=16070400,d=31536000;var c=function(){};c.getRelationshipModule=function(){return LI.Controls.getControl($("#"+a)[0],"RelationshipLoader")};c.getHowYouMet=function(N){return LI.Controls.getControl(N.find(".annotation-info.how-you-met")[0],"RelationshipHowYouMet")};c.getValue=function(P){var O=P.val(),Q=P.attr("id"),N;if(Q!==undefined){N=P.parent().find('label[for="'+Q+'"]');if(N.length&&N.text()===O){return""}}return O};c.getHeight=function(){var P=$("#"+a),O=P.find(".relationship-container"),Q=P.height(),N;P.css("height",Q);O.css("height","");P.removeClass(m);N=O.height();P.addClass(m);P.css("height","");return N+J};c.slideUp=function(N){N.animate({height:v},G)};c.slideDown=function(O){var N=c.getHeight();O.animate({height:N},G,function(){O.css("height","auto")})};c.addProgressIndicator=function(O){var N=O.find(".progress-indicator");if(!N.length){N=$('<div class="progress-indicator"></div>');N.appendTo(O)}return N};c.showProgressIndicator=function(N){c.addProgressIndicator(N);N.addClass("form-submit-processing")};c.hideProgressIndicator=function(N){N.removeClass("form-submit-processing")};c.addHoverEvents=function(N){N.unbind("mouseenter mouseleave");N.hover(function(O){$(this).addClass("hover")},function(O){$(this).removeClass("hover")})};c.showGlobalError=function(N){LI.injectAlert(N,"error",null,false,true);window.setTimeout(function(){LI.removeAlert()},f)};c.showSuccess=function(N){LI.injectAlert(N,"success",null,false,true);window.setTimeout(function(){LI.removeAlert()},f)};c.track=function(O,N){if(window.EventsTracking){window.EventsTracking.track(O,N)}};c.verifyPluralForm=function(O){var N;if(O===1){N=O+" day";return N}else{N=O+" days";return N}};LI.define("RelationshipModule");LI.RelationshipModule=function(O,N){N=N||{};this.$el=$(O).parent();this.$annotationContainer=this.$el.find(".annotation");this.$relationshipContainer=this.$el.find(".relationship-container");this.$contactContainer=this.$el.find(".contact-container");this.$el.on("click",$.proxy(this.handleClick,this));this.contactId=N.contactId;n=N.staticUrl;this.note=new RelationshipNote();this.howeWeMet=new RelationshipHowYouMet();this.reminder=new RelationshipReminder();this.$el.show();this.checkDefaultState();this.addBroadcastEventsListener()};LI.RelationshipModule.prototype.checkDefaultState=function(){var N=this.$el.find(".relationship-item");if(!N.length){}c.addHoverEvents(N)};LI.RelationshipModule.prototype.addBroadcastEventsListener=function(){window.Broadcaster.on("evernote.removed",function(P,O){var N=$("#relationship-item-"+O.id),Q=c.getRelationshipModule();if(N.length){N.remove()}if(Q){Q.updateRelationshipData(O.id,null)}})};LI.RelationshipModule.prototype.handleClick=function(N){var P=$(N.target),O=P.parent(),Q=P.parents(".relationship-item"),R;if(P.closest(".timeline-plus").length){N.preventDefault();this.selectAnnotationTab(w.NOTE)}else{if(P.closest(".card-tab").length){N.preventDefault();this.selectTab(P)}else{if(P.closest(".annotation-tab").length&&!P.closest(".relationship-tag-menu").length){N.preventDefault();R=P.closest(".annotation-tab");this.selectAnnotationTab(R.data("li-annotation-type"))}else{if(P.closest(".view-less-bar").length){N.preventDefault();this.viewLess()}else{if(P.closest(".view-more-bar").length){N.preventDefault();this.viewMore()}else{if(P.closest(".minimize").length){N.preventDefault();if(!P.hasClass("closed")){this.minimizeRelationshipModule()}}else{if(P.closest(".relationship-action").length){N.preventDefault();this.handleRelationshipAction(P)}else{if(P.closest(".mark-as-complete").length){this.markReminderAsCompleted(P)}else{if(P.closest(".toggle-see-more").length){N.preventDefault();this.toggleRelationshipContentNote(P)}else{if(Q.length&&P.closest("h4").length){N.preventDefault();this.handleRelationshipItem(Q)}}}}}}}}}}};LI.RelationshipModule.prototype.toggleRelationshipContentNote=function(P){var N=P.closest(".toggle-see-more"),Q=N.parents("p");Q.toggleClass("more");if(!Q.hasClass("more")){var O=P.parents(".relationship-item");$("html,body").animate({scrollTop:O.position().top},"slow")}};LI.RelationshipModule.prototype.markReminderAsCompleted=function(Q){var O=Q.parents("div.relationship-item"),T=O.data("li-item-id"),S=$("#relationship-item-"+T),N=this.getRelationshipItem(T),P=this.getContactId(),R;if(N){R={description:N.text,interval_description:N.interval_description,recurring:N.recurring,due_date:N.recurring?null:N.date,completed:true};c.showProgressIndicator(S);this.reminder.update(P,T,R).done($.proxy(this.handleReminderUpdate,this)).fail($.proxy(this.handleReminderError,this,T))}};LI.RelationshipModule.prototype.handleReminderError=function(P,N){var O=$("#relationship-item-"+P);c.hideProgressIndicator(O);c.showGlobalError(N)};LI.RelationshipModule.prototype.handleReminderUpdate=function(N){var R=c.getRelationshipModule(),P,T,S=N.id,P=$("#relationship-item-"+S),O=P.parent(),Q=N.next_reminder;if(P.length){c.hideProgressIndicator(P);T=P.prev();if(Q){P.remove()}else{P.slideUp(200,function(){P.remove()})}}if(R){R.updateRelationshipData(N.id,Q?N.next_reminder:null)}if(Q){dust.render(B,N,function(V,U){if(T.length){$(U).insertAfter(T)}else{O.append(U)}c.addHoverEvents($("#relationship-item-"+N.id))})}c.showSuccess("Completed!")};LI.RelationshipModule.prototype.viewMore=function(){var N=c.getRelationshipModule();if(N){N.viewMore()}this.$el.removeClass(m).addClass(H);this.addHoverEvents()};LI.RelationshipModule.prototype.minimizeRelationshipModule=function(){var N=c.getRelationshipModule();if(N){N.minimize(true)}};LI.RelationshipModule.prototype.addHoverEvents=function(){var N=this.$el.find(".relationship-item");c.addHoverEvents(N)};LI.RelationshipModule.prototype.viewLess=function(){var O=this.$el.position().top-K;var N=c.getRelationshipModule();if(N){N.viewLess()}this.$el.removeClass(H).addClass(m);$("html,body").animate({scrollTop:O},"slow");this.addHoverEvents()};LI.RelationshipModule.prototype.handleRelationshipItem=function(O){var U=O.data("li-item-id"),P=O.data("li-item-type"),R=O.data("li-item-source"),T=this.getContactId(),S=false;var N=true;if((P===w.MESSAGE||P===w.CALENDAR_EVENT||P===w.EVERNOTE)&&R!=="LinkedIn"){var Q=this.getRelationshipContent();N=Q&&Q.showThirdPartyItemDetails}switch(P){case w.MESSAGE:if(N){Connected.UI.Dialogs.openInteractionMessage(T,R,U);S=true}break;case w.CALENDAR_EVENT:if(N){Connected.UI.Dialogs.openCalendarEvent(U).done(function(V){$(".calendar-event-dialog-content .source .contact-source").tooltip()});S=true}break;case w.EVERNOTE:if(N){Connected.UI.Dialogs.openEvernote(U);S=true}break}if(S){window.Broadcaster.trigger("relationship.item.opened",{id:U})}};LI.RelationshipModule.prototype.handleRelationshipAction=function(Q){var O=Q.parents("div.relationship-item"),R=O.data("li-item-id"),N=Q.hasClass("delete"),P=Q.hasClass("edit");if(R!==undefined&&R!==false){if(N){this.confirmDeleteRelationshipItem(R)}else{if(P){this.editRelationshipItem(R)}}}};LI.RelationshipModule.prototype.getRelationshipItem=function(Q){var P=c.getRelationshipModule(),O=P&&P.getRelationshipData(),N=O&&O[Q];return N};LI.RelationshipModule.prototype.getRelationshipContent=function(){var O=c.getRelationshipModule(),N=O&&O.content;return N};LI.RelationshipModule.prototype.getContactId=function(){return this.contactId};LI.RelationshipModule.prototype.editRelationshipItem=function(O){var N=this.getRelationshipItem(O);if(!N){return}switch(N.type){case w.NOTE:this.editNote(O);break;case w.HOW_WE_MET:this.editHowWeMet();break;case w.REMINDER:this.editReminder(O);break;default:break}};LI.RelationshipModule.prototype.editNote=function(P){var O=this.getRelationshipItem(P),N=this;this.resetAnnotationTabs();$(".annotation-info").hide();$(".relationship-item").show();dust.render(l,O,function(R,Q){N.renderEditForm(P,Q)})};LI.RelationshipModule.prototype.editReminder=function(R){var Q=this.getRelationshipItem(R),N=this;this.resetAnnotationTabs();$(".annotation-info").hide();$(".relationship-item").show();var N=this;var O=Fiber.extend(function(){var S={text:null,interval:null,contact_id:null,id:null,recurring:null,date:null,type:null,start_date:null,profile_url:null,isCustomDate:null,intervalDays:null};return{init:function(T){this._data=$.extend({},S,T)},_isIntervalCustomDate:function(U){var T=U.interval;if(U.recurring===true){return T!==z&&T!==s&&T!==x&&T!==I&&T!==d}else{return false}},_isIntervalExist:function(T){if(T.interval===undefined||T.interval===null){return false}else{return true}},toData:function(){var V,U,T;if(this._isIntervalExist(this._data)){U=Math.floor(parseInt(this._data.interval,10))/A;V=c.verifyPluralForm(U)}else{T=this._data.date-this._data.start_date;U=Math.floor(parseInt(T,10))/A;V=c.verifyPluralForm(U)}return{text:this._data.text,contactId:this._data.contact_id,id:this._data.id,date:this._data.date,type:this._data.type,recurring:this._data.recurring,startDate:this._data.start_date,isCustomDate:this._isIntervalCustomDate(this._data),intervalDays:V}}}});var P=new O(Q);dust.render(y,P.toData(),function(T,S){N.renderEditForm(R,S,P._data)})};LI.RelationshipModule.prototype.editHowWeMet=function(){var Q=w.HOW_WE_MET,P=this.getRelationshipItem(Q),N=this,O;this.resetAnnotationTabs();$(".annotation-info").hide();$(".relationship-item").show();P.editMode=true;dust.render(r,P,function(S,R){O=N.renderEditForm(Q,R);N.checkAutocomplete(O)})};LI.RelationshipModule.prototype.renderEditForm=function(S,O,Q){var R,N;if(Q){if(Q.recurring){R=$("#relationship-item-recurring");N=$(O)}else{R=$("#relationship-item-"+S);N=$(O)}}else{R=$("#relationship-item-"+S);N=$(O)}R.hide().before(N);N.addClass("edit");N.find(".annotation-text").focus();$("html,body").animate({scrollTop:N.position().top},"slow");var P=R.prev();if(P.length){LI.Controls.parseFragment(P[0])}return P};LI.RelationshipModule.prototype.confirmDeleteRelationshipItem=function(O){var N=this.getRelationshipItem(O);if(!N){return}this.showDeleteItemConfirmDialog(N.type,O)};LI.RelationshipModule.prototype.deleteRelationshipItem=function(T){var Q=this.getRelationshipItem(T),O=this.$annotationContainer,S,R,N,P=this;if(!Q){return}if(Q.recurring){S=$("#relationship-item-recurring")}else{S=$("#relationship-item-"+T)}R=c.getRelationshipModule();if(Q.type===w.NOTE){c.showProgressIndicator(S);this.note.remove(this.getContactId(),T).done(function(U){if(U&&U.status==="success"){S.remove();if(R){R.updateRelationshipData(T,null)}P.checkForEmptyItems()}})}else{if(Q.type===w.HOW_WE_MET){c.showProgressIndicator(S);this.howeWeMet.update(this.getContactId(),"","").done(function(U){if(U&&U.status==="success"){S.remove();if(R){R.updateRelationshipData(T,null)}N=c.getHowYouMet(O);if(N){N.clearIntroContact()}P.checkForEmptyItems()}})}else{if(Q.type===w.REMINDER){c.showProgressIndicator(S);this.reminder.remove(this.getContactId(),T).done(function(U){if(U&&U.status==="success"){S.remove();if(R){R.updateRelationshipData(T,null)}P.checkForEmptyItems()}})}else{if(Q.type===w.SOURCE_CONTACT_NOTE){c.showProgressIndicator(S);this.note.removeSourceContactNote(this.getContactId(),Q.source_contact_id).done(function(U){if(U&&U.status==="success"){S.remove();if(R){R.updateRelationshipData(T,null)}P.checkForEmptyItems()}})}}}}};LI.RelationshipModule.prototype.checkForEmptyItems=function(){var N=this.$relationshipContainer.find(".relationship-item");if(!N.length){this.selectAnnotationTab(w.NOTE)}};LI.RelationshipModule.prototype.selectTab=function(O){var N=c.getRelationshipModule(),P=O.closest(".card-tab");if(N){N.selectTab(P.hasClass("relationship-tab")?"relationship":"contacts")}c.track(window.EventsTracking.Types.RELATIONSHIP_TAB_TOGGLE,{tab:P.hasClass("relationship-tab")?e.RELATIONSHIP:e.CONTACT_INFO})};LI.RelationshipModule.prototype.selectAnnotationTab=function(Q){var R=this.$el.find(".annotation-tab."+Q),N=this.$annotationContainer.find(".annotation-info."+Q),P=this.$annotationContainer.find(".annotation-types"),O=Q;this.resetAnnotationTabs();N.show();R.addClass("selected");P.addClass("selected");N.find(".annotation-text").filter(":visible:first").focus();if(N.hasClass("how-you-met")){this.loadHowYouMet(this.$annotationContainer);this.checkAutocomplete(this.$annotationContainer)}if(Q===w.TAGS){this.resetOnClickingOutsideMenu()}if(O==="how-you-met"){O="how_you_met"}else{if(O==="follow-up"){O="reminder"}else{if(O==="tags"){O="tag"}}}c.track(window.EventsTracking.Types.RELATIONSHIP_INPUT_ACTION_TOGGLE,{action:O})};LI.RelationshipModule.prototype.resetOnClickingOutsideMenu=function(){var O,N=this;if(!this.clickOutsideEventInitialized){O=this.$el.find(".annotation-tab.tags");$("body").click(function(P){var Q=$(P.target);if(O.hasClass("selected")&&!Q.parents(".annotation-tab.tags").length){N.resetAnnotationTabs()}});this.clickOutsideEventInitialized=true}};LI.RelationshipModule.prototype.showDeleteItemConfirmDialog=function(R,Q){var P=this.$el,O=$("#delete-relationship-item-confirm-dialog"),N=this;if(O.length){O.remove()}var S=w.GET_DISPLAY_NAME(R);if(S){S=S.toLowerCase()}dust.render(k,{deleteInfo:S},function(U,T){P.append(T);N.createAndShowDeleteItemConfirmDialog(R,Q)})};LI.RelationshipModule.prototype.createAndShowDeleteItemConfirmDialog=function(R,Q){var N=$("#delete-relationship-item-confirm-dialog"),P=N.find(".confirm-actions"),O,S;S=w.GET_DISPLAY_NAME(R);O=S?'Delete "{0}"':"Delete Information";this.deleteRelationshipItemConfirmDialog=new UIControls.Dialog(N,{title:String.format(O,S)});this.deleteRelationshipItemConfirmDialog.open();P.click($.proxy(this.handleDeleteItemConfirmDialogAction,this,Q))};LI.RelationshipModule.prototype.handleDeleteItemConfirmDialogAction=function(P,N){var O=$(N.target);N.preventDefault();this.deleteRelationshipItemConfirmDialog.close();if(O.closest(".delete-action").length){this.deleteRelationshipItem(P)}};LI.RelationshipModule.prototype.checkAutocomplete=function(O){var N=c.getHowYouMet(O);if(N){N.fetchContacts()}};LI.RelationshipModule.prototype.loadHowYouMet=function(O){var N=c.getHowYouMet(O);if(N){N.populateForEdit()}};LI.RelationshipModule.prototype.resetAnnotationTabs=function(){this.$annotationContainer.find(".annotation-info").hide();this.$annotationContainer.find(".annotation-types li").removeClass("selected");this.$annotationContainer.find(".annotation-types").removeClass("selected")};var o=function(O,N){if(arguments.length===0){return}this.$el=$(O);this.$relationshipContainer=this.$el.parents(".relationship-container");this.$annotationContainer=this.$relationshipContainer.find(".annotation");this.$relationshipItemsContainer=this.$relationshipContainer.find(".relationship-items");this.$saveButton=this.$el.find(".save-action");this.$saveButton.on("click",$.proxy(this.save,this));this.$cancelButton=this.$el.find(".cancel-action");this.$cancelButton.on("click",$.proxy(this.cancel,this))};o.prototype.save=function(N){};o.prototype.cancel=function(N){};o.prototype.getRelationshipModule=function(){var N=LI.Controls.getControl(this.$relationshipContainer.parent()[0],"RelationshipModule");return N};o.prototype.getContactId=function(){var N=this.getRelationshipModule();return N&&N.getContactId()};o.prototype.resetAnnotationTabs=function(){var N=this.getRelationshipModule();return N&&N.resetAnnotationTabs()};o.prototype.getProgressContainer=function(){return this.$el.parent()};o.prototype.handleError=function(N){c.showGlobalError(N)};LI.define("RelationshipNote");LI.RelationshipNote=function(O,N){o.call(this,O,N);this.$noteText=this.$el.find(".note-add-text");this.note=new RelationshipNote();this.noteId=N.id};LI.RelationshipNote.prototype=new o();LI.RelationshipNote.prototype.constructor=LI.RelationshipNote;LI.RelationshipNote.prototype.save=function(N){N.preventDefault();var O=c.getValue(this.$noteText),P=$.proxy(this.handleSave,this),Q=this.getContactId();c.showProgressIndicator(this.getProgressContainer());if(O.trim()!==""){if(this.noteId){this.note.update(Q,this.noteId,O).done(P).fail($.proxy(this.handleError,this))}else{this.note.add(Q,O).done(P).fail($.proxy(this.handleError,this))}}else{c.hideProgressIndicator(this.getProgressContainer());this.handleError("Please add a note.");this.$noteText.focus()}};LI.RelationshipNote.prototype.handleError=function(O){var N;if(O){N="Sorry, there was a problem saving note: "+O}else{N="Sorry, there was a problem saving note. Please try again later."}c.hideProgressIndicator(this.getProgressContainer());c.showGlobalError(N)};LI.RelationshipNote.prototype.cancel=function(N){N.preventDefault();this.cancelEditForm()};LI.RelationshipNote.prototype.cancelEditForm=function(){var O,N=this.$el.parent();if(this.noteId){N.remove();O=$("#relationship-item-"+this.noteId);O.show()}else{this.resetAnnotationTabs()}};LI.RelationshipNote.prototype.handleSave=function(N){if(N&&N.status==="success"){c.hideProgressIndicator(this.getProgressContainer());this.cancelEditForm();this.renderAddedContent(N);this.$noteText.val("");this.resetAnnotationTabs()}};LI.RelationshipNote.prototype.renderAddedContent=function(N){var R=c.getRelationshipModule(),P,T,S=N.note_id,O=this.$relationshipItemsContainer,Q=!Boolean(this.noteId);N.type=w.NOTE;N.id=S;if(this.noteId){P=$("#relationship-item-"+this.noteId);T=P.prev();P.remove()}if(R){R.updateRelationshipData(N.id,N)}dust.render(B,N,function(V,U){if(!Q&&T.length){$(U).insertAfter(T)}else{O.prepend(U)}c.addHoverEvents($("#relationship-item-"+N.id));LI.Controls.parseFragment($(U)[0])})};LI.define("RelationshipHowYouMet");LI.RelationshipHowYouMet=function(O,N){o.call(this,O,N);this.$howYouMetText=this.$el.find(".how-we-met-edit-description-text");this.$introContactText=this.$el.find(".how-we-met-edit-intro-contact-text");this.$introContact=this.$el.find(".intro-contact-list");this.howYouMet=new RelationshipHowYouMet();this.contacts=new RelationshipContacts();this.autocompleteIntialized=false;this.$introContact.on("click",$.proxy(this.handleIntroContactClick,this));this.checkDefaultState()};LI.RelationshipHowYouMet.prototype=new o();LI.RelationshipHowYouMet.prototype.constructor=LI.RelationshipHowYouMet;LI.RelationshipHowYouMet.prototype.handleIntroContactClick=function(N){var O=$(N.target);if(O.closest("remove")){this.clearIntroContact()}};LI.RelationshipHowYouMet.prototype.clearIntroContact=function(){this.introContactId=null;this.$introContact.hide();this.$introContact.html("");this.$introContactText.show().focus()};LI.RelationshipHowYouMet.prototype.checkDefaultState=function(){var O=this.getRelationshipModule(),N=O&&O.getRelationshipItem(w.HOW_WE_MET);if(N){this.renderIntroContact(N.intro_contact_id,N.intro_contact_name,N.intro_contact_profile_image_url)}};LI.RelationshipHowYouMet.prototype.save=function(N){var P=c.getValue(this.$howYouMetText),O=this;if(P.trim()===""&&!this.introContactId){c.showGlobalError("Please add the description of how you met");return}c.showProgressIndicator(this.getProgressContainer());this.howYouMet.update(this.getContactId(),P,this.introContactId).done(function(Q){if(Q&&Q.status==="success"){O.handleSave(Q)}}).fail($.proxy(this.handleError,this))};LI.RelationshipHowYouMet.prototype.handleError=function(N){c.hideProgressIndicator(this.getProgressContainer());c.showGlobalError(N)};LI.RelationshipHowYouMet.prototype.fetchContacts=function(){if(!this.autocompleteIntialized&&!this.contacts.isLoaded()){this.contacts.fetch().done($.proxy(this.initAutocomplete,this))}};LI.RelationshipHowYouMet.prototype.initAutocomplete=function(){var N=this.contacts.getContacts(),O=n+C;if(this.autocompleteIntialized){return}this.$introContactText.autocomplete(N,{selectFirst:true,width:this.$introContactText.width(),scrollHeight:M,create:function(){$(this).autocomplete("search","")},formatMatch:function(P){return P.name?P.name:""},formatResult:function(P){return P.name?P.name:""},formatItem:function(P){return'<div style="float:left"><img src="'+Connected.Utils.encodeHTML((P.profile_image_url&&P.profile_image_url.length>0)?P.profile_image_url:O)+'" height="40px" width="40px"/></div><h4>'+Connected.Utils.encodeHTML(P.name)+"</h4>"}}).result($.proxy(this.handleAutocompleteSelection,this));this.autocompleteIntialized=true};LI.RelationshipHowYouMet.prototype.handleAutocompleteSelection=function(O,N){this.renderIntroContact(N.id,N.name,N.profile_image_url)};LI.RelationshipHowYouMet.prototype.renderIntroContact=function(Q,N,O){var P=n+C;if(Q){this.introContactId=Q;this.$introContactText.hide();this.$introContactText.val("");this.$introContact.html('<span class="jellybean"><img src="'+Connected.Utils.encodeHTML((O&&O.length>0)?O:P)+'" height="20px" width="20px"/><span class="value">'+Connected.Utils.encodeHTML(N)+'</span><span class="remove"></span></span>');this.$introContact.show()}};LI.RelationshipHowYouMet.prototype.populateForEdit=function(){var O=this.getRelationshipModule(),N=O&&O.getRelationshipItem(w.HOW_WE_MET);if(O&&N){if(N.intro_contact_id){this.renderIntroContact(N.intro_contact_id,N.intro_contact_name,N.intro_contact_profile_image_url)}if(N.text){this.$howYouMetText.val(N.text)}}};LI.RelationshipHowYouMet.prototype.handleSave=function(N){c.hideProgressIndicator(this.getProgressContainer());this.renderAddedContent(N);this.resetAnnotationTabs();this.$howYouMetText.val("");this.$introContactText.val("")};LI.RelationshipHowYouMet.prototype.renderAddedContent=function(N){var O=this.$relationshipItemsContainer,P,S=c.getRelationshipModule(),Q=N.how_we_met,R=true;N.type=w.HOW_WE_MET;this.cancelEditForm();P=$("#relationship-item-"+N.type);if(P.length){P.remove();R=false}if(S){S.updateRelationshipData(N.type,N.how_we_met)}Q.static_url=n;dust.render(B,N.how_we_met,function(U,T){O.append(T);c.addHoverEvents($("#relationship-item-"+N.type));P=$("#relationship-item-"+N.type);if(R){$("html,body").animate({scrollTop:P.position().top},"slow")}LI.Controls.parseFragment(P[0])})};LI.RelationshipHowYouMet.prototype.cancelEditForm=function(){var N=this.$el.parent();if(N.parent().hasClass("relationship-items")){N.remove()}else{this.resetAnnotationTabs()}};LI.RelationshipHowYouMet.prototype.cancel=function(N){N.preventDefault();this.cancelEditForm();var O=$("#relationship-item-"+w.HOW_WE_MET);O.show()};LI.define("RelationshipReminder");LI.RelationshipReminder=function(O,N){o.call(this,O,N);this.$reminderText=this.$el.find(".follow-up-add-text");this.$followUpTimeContainer=this.$el.find(".follow-up-time");this.$recurringOption=this.$el.find('input[type="radio"].recurring');this.$recurringOptionChecks=this.$followUpTimeContainer.find("div.checkmark");this.$recurringLabel=this.$followUpTimeContainer.find(".recurring-label");this.$recurringMenu=this.$followUpTimeContainer.find(".recurring-dropdown");this.$newCustomRangeLink=this.$followUpTimeContainer.find(".new-custom-range-tag");this.$newCustomForm=this.$followUpTimeContainer.find(".new-custom-range-form");this.$newCustomRangeField=this.$followUpTimeContainer.find(".new-custom-range-textbox");this.$customRange=this.$followUpTimeContainer.find(".custom-range");this.$saveCustomeRangeAction=this.$followUpTimeContainer.find(".new-custom-range-save");this.reminder=new RelationshipReminder();this.reminderId=N.id;this.bindEvents();if(this.reminderId){this.selectReminder(N.reminderDate,N.startDate,N.recurring,N.isCustomDate)}else{this.calculateDueDate(this.$followUpTimeContainer.find('input[type="radio"]:checked').val())}};LI.RelationshipReminder.prototype=new o();LI.RelationshipReminder.prototype.constructor=LI.RelationshipReminder;LI.RelationshipReminder.prototype.bindEvents=function(){this.$followUpTimeContainer.click($.proxy(this.handleTimeSelecion,this));this.$saveCustomeRangeAction.click($.proxy(this.applyCustomRange,this))};LI.RelationshipReminder.prototype.checkNewOrAdded=function(){var Q=c.getRelationshipModule(),O=Q&&Q.getRelationshipData(),N=O&&O[this.reminderId],P;if(N){P=N.recurring;this.previous_item_type=P}};LI.RelationshipReminder.prototype.handleTimeSelecion=function(O){this.checkNewOrAdded();var N=$(O.target),S=N.closest("input"),Q=N.closest("li.recurring-option"),P=(Q.length>0),R;if(S.length){R=S.val();this.calculateDueDate(R)}else{if(Q.length){R=Q.data("li-value");if(R===h.CUSTOM_DATE){this.toggleNewCustomRangeForm(true)}else{this.$recurringOptionChecks.removeClass("checked");this.$recurringOption.prop("checked",true);Q.find("div.checkmark").addClass("checked");this.dueDate=null;this.recurringIntervalDescription=R}}}};LI.RelationshipReminder.prototype.applyCustomRange=function(N){var Q=this.$newCustomRangeField.val(),P=this.validateNumber(Q),O=this.validateRange(Q),R;R=c.verifyPluralForm(parseInt(Q,10));if(P&&O){this.changeDisplay(R);this.checkSelectedDate(Q,R)}else{this.$newCustomRangeField.focus()}};LI.RelationshipReminder.prototype.validateRange=function(N){if(N.trim()>365){c.showGlobalError("Please enter a number less than 365");return false}return true};LI.RelationshipReminder.prototype.validate=function(N){return((parseFloat(N)===parseInt(N,10))&&!isNaN(N)&&N>0)};LI.RelationshipReminder.prototype.validateNumber=function(N){if(N.trim().length===0){c.showGlobalError("Please enter a date range");return false}else{if(!this.validate(N)){c.showGlobalError("Please enter a valid number");return false}else{return true}}};LI.RelationshipReminder.prototype.changeDisplay=function(N){this.$customRange.toggleClass("hidden",false);this.$customRange.find("label").text("Every "+N);this.$customRange.data("li-value",N);this.$newCustomRangeLink.find("label").text("Edit custom range");this.toggleNewCustomRangeForm(false)};LI.RelationshipReminder.prototype.checkSelectedDate=function(O,N){this.$recurringOptionChecks.removeClass("checked");this.$recurringOption.prop("checked",true);this.$customRange.find("div.checkmark").addClass("checked");this.dueDate=null;this.recurringIntervalDescription=N;this.interval=O*24*60*60};LI.RelationshipReminder.prototype.toggleNewCustomRangeForm=function(N){this.$newCustomRangeLink.toggleClass("hidden",N);this.$newCustomForm.toggleClass("hidden",!N);if(N){this.$newCustomRangeField.focus()}else{c.hideProgressIndicator(this.$newCustomForm);this.$newCustomRangeField.val("").blur()}};LI.RelationshipReminder.prototype.calculateDueDate=function(P){var N=new Date(),O=N.getTime(),Q;switch(P){case h.DAY:this.dueDate=(O+L)/g;break;case h.WEEK:this.dueDate=(O+q)/g;break;case h.MONTH:Q=new Date(N.getFullYear(),N.getMonth()+1,N.getDate());this.dueDate=Q.getTime()/g;break;case h.THREE_MONTHS:Q=new Date(N.getFullYear(),N.getMonth()+3,N.getDate());this.dueDate=Q.getTime()/g;break;case h.SIX_MONTHS:Q=new Date(N.getFullYear(),N.getMonth()+6,N.getDate());this.dueDate=Q.getTime()/g;break;case h.YEAR:Q=new Date(N.getFullYear()+1,N.getMonth(),N.getDate());this.dueDate=Q.getTime()/g;break;case h.RECURRING:this.setDefaultRecurringInterval();break;default:break}};LI.RelationshipReminder.prototype.setDefaultRecurringInterval=function(){if(!this.$recurringMenu.find(".checked").length){this.dueDate=null;this.$followUpTimeContainer.find(".week div.checkmark").addClass("checked");this.recurringIntervalDescription=p}};LI.RelationshipReminder.prototype.selectReminder=function(S,R,O,Q){var V=S*1000,T=V-R*1000,U="day",P=O?".recurring-option":".reminder-option",N;if(!Q){if(T>0){if(Math.floor(T/t)){U="year"}else{if(Math.floor(T/u)){U="6months"}else{if(Math.floor(T/D)){U="3months"}else{if(Math.floor(T/i)){U="month"}else{if(Math.floor(T/q)){U="week"}else{if(7===Math.ceil(T/L)){U="week"}else{U="day"}}}}}}}else{U="day"}}N=this.$el.find(P+"."+U);if(O){this.$recurringOption.prop("checked",true);N.find(".checkmark").addClass("checked")}else{N.prop("checked",true)}};LI.RelationshipReminder.prototype.save=function(Y){Y.preventDefault();var N=c.getValue(this.$reminderText),T=this.getContactId(),R=this.$followUpTimeContainer.find('input[type="radio"]:checked'),W=R.val(),S=(W===h.RECURRING),V=S?this.recurringIntervalDescription:null,X=S?null:this.dueDate,P=new Date(),O=P.getTime(),Q=$.proxy(this.handleSave,this);var U={description:N,due_date:X,recurring:S,interval_description:V,interval:this.interval,start_date:O/g};c.showProgressIndicator(this.getProgressContainer());if(this.reminderId){this.reminder.update(T,this.reminderId,U).done(Q).fail($.proxy(this.handleError,this))}else{this.reminder.add(T,U).done(Q).fail($.proxy(this.handleError,this))}};LI.RelationshipReminder.prototype.handleError=function(N){c.hideProgressIndicator(this.getProgressContainer());c.showGlobalError(N)};LI.RelationshipReminder.prototype.cancel=function(N){N.preventDefault();this.cancelEditForm();this.setDefaultRadio();this.$reminderText.val("")};LI.RelationshipReminder.prototype.setDefaultRadio=function(){var S=this.$followUpTimeContainer.find('input[type="radio"]:checked'),Q=S.val(),N=new Date(),R=N.getTime(),P=(Q===h.RECURRING),O;this.dueDate=(R+L)/g;if(!P){S.prop("checked",false)}else{this.$recurringOptionChecks.removeClass("checked");this.$recurringMenu.find("ul > li:eq(1) .checkmark").addClass("checked")}O=this.$followUpTimeContainer.find("label[class=follow-up-option]").first().find('input[type="radio"]');O.prop("checked",true)};LI.RelationshipReminder.prototype.cancelEditForm=function(){var R,N=this.$el.parent(),Q=c.getRelationshipModule(),P=Q&&Q.getRelationshipData(),O=P&&P[this.reminderId];if(O){if(O.interval){N.remove();R=$("#relationship-item-recurring");R.show()}else{if(this.reminderId){N.remove();R=$("#relationship-item-"+this.reminderId);R.show()}else{this.resetAnnotationTabs()}}}else{this.resetAnnotationTabs()}};LI.RelationshipReminder.prototype.handleSave=function(N){if(N&&N.status==="success"){c.hideProgressIndicator(this.getProgressContainer());this.cancelEditForm();this.renderAddedContent(N);this.$reminderText.val("");this.resetAnnotationTabs()}this.setDefaultRadio()};LI.RelationshipReminder.prototype.renderAddedContent=function(N){var R=c.getRelationshipModule(),P,T,S=N.id,O=this.$relationshipItemsContainer,Q=!Boolean(this.reminderId);N.type=w.REMINDER;N.id=S;if(N.interval===undefined){N.interval=this.interval}if(this.previous_item_type&&!N.recurring){P=$("#relationship-item-recurring");if(P.length){P.remove()}}if(N.recurring){P=$("#relationship-item-recurring");if(P.length){P.remove()}}if(this.reminderId){P=$("#relationship-item-"+this.reminderId);T=P.prev();P.remove()}if(R){R.updateRelationshipData(N.id,N)}dust.render(B,N,function(V,U){if(!Q&&T.length){$(U).insertAfter(T)}else{O.prepend(U)}if(N.recurring){c.addHoverEvents($("#relationship-item-recurring"))}else{c.addHoverEvents($("#relationship-item-"+N.id))}LI.Controls.parseFragment($(U)[0])})};LI.define("RelationshipTag");LI.RelationshipTag=function(O,N){o.call(this,O,N);this.$tagMenu=this.$el;this.$newTagField=this.$tagMenu.find(".new-tag-textbox");this.$newTagLink=this.$tagMenu.find(".new_tag_link");this.$newTagForm=this.$tagMenu.find(".new-tag-form");this.$applyAction=this.$tagMenu.find("li.apply-button");this.$headerTags=$("#relationship-header-tags");this.url="/contacts/services/manage_tags_div/";this.tagSelectionMenu=new Connected.UI.CommandMenu(this.$tagMenu);this.$saveButton=this.$tagMenu.find("#bulk_new_tag_save");this.contactTags=new RelationshipContactTags();this.checkAppliedTags();this.bindEvents()};LI.RelationshipTag.prototype=new o();LI.RelationshipTag.prototype.constructor=LI.RelationshipTag;LI.RelationshipTag.prototype.bindEvents=function(){var O=this.tagSelectionMenu,N=this;$(O).on("itemclicked",$.proxy(this.onSelectTagMenuItemClicked,this));$(O).on("itemchecked",$.proxy(this.onSelectTagMenuItemChecked,this));this.$saveButton.on("click",$.proxy(this.saveNewTag,this));this.$applyAction.on("click",$.proxy(this.onApplyTagsClicked,this));window.TagManagerBroadcaster.on("tag.removed",function(Q,P){O.removeItem(P.id);$('[id="header-tag-item-'+P.id+'"]').remove();N.generateCurrentlyAppliedTags()});window.TagManagerBroadcaster.on("tag.renamed",function(T,Q){var S={id:Q.id,text:Q.name};if(Q.hasOwnProperty("newId")){S.newId=Q.newId}var P=$('[id="relationship-tag-item-'+Q.id+'"]'),R=P.parent();O.updateItem(S);R.data("item-name",Q.name);P.closest("li").data("item-name",Q.name);if(Q.hasOwnProperty("newId")){P.closest("li").data("item-id",Q.newId)}N.addHeaderTags(N.getSelectedTags())});window.TagManagerBroadcaster.on("tag.added",function(R,Q){var P=$('[id="relationship-tag-item-'+Q.id+'"]'),S='<li data-item-id="{0}" data-item-name="{1}" data-item-type="option"><div class="checkbox-div"><input id="relationship-tag-item-{0}" type="checkbox" /><label>&nbsp;</label></div><a href="#">{1}</a></li>';if(P.length===0){O.addItem({id:Q.id,text:Q.name},S);P=$('[id="relationship-tag-item-'+Q.id+'"]');P.prop("checked",true)}N.addHeaderTags(N.getSelectedTags());N.generateCurrentlyAppliedTags()});this.$newTagField.on("keydown",function(P){if(P.keyCode===27){N.toggleNewTagForm(false)}})};LI.RelationshipTag.prototype.save=function(N){N.preventDefault();N.stopPropagation()};LI.RelationshipTag.prototype.checkAppliedTags=function(){var O=c.getRelationshipModule(),N=[];if(O){N=O.getContactTags()}else{if(fs.payload("profile_v2_relationship")){N=fs.payload("profile_v2_relationship").contact_tags}}if(N&&N.length){$.each(N,function(P,Q){$('[id="relationship-tag-item-'+Q.id+'"]').prop("checked",true)})}this.generateCurrentlyAppliedTags()};LI.RelationshipTag.prototype.closeTagMenu=function(){var N=this.$relationshipContainer.find(".annotation-tab.tags"),O=N.find(".wrapper-dropdown-list > ul > li");N.removeClass("selected");O.removeClass("selected")};LI.RelationshipTag.prototype.addHeaderTags=function(Q){var P,N,R=this.$headerTags,O=[];$.each(Q,function(S,T){P=$('[id="relationship-tag-item-'+T+'"]');N=P.closest("li");if(N.length){O.push({id:N.data("item-id"),name:N.data("item-name")})}});dust.render(b,{contact_tags:O},function(T,S){R.html(S);LI.Controls.parseFragment(R[0])})};LI.RelationshipTag.prototype.removeHeaderTags=function(N){$.each(N,function(O,P){$('[id="header-tag-item-'+P+'"]').remove()})};LI.RelationshipTag.prototype.checkApplyTagsState=function(){var O=this.$tagMenu.find('input[type="checkbox"]'),N=(O.filter(":checked").length<1);this.$applyAction.toggle(!N)};LI.RelationshipTag.prototype.getSelectedTags=function(){var N=this.$tagMenu.find('input[type="checkbox"]'),O=N.filter(":checked"),P=[];O.each(function(){var T=$(this).closest("li");var R=T.data("item-id");var S=T[0];var Q=S.attributes["data-item-id"].value;if(Q!==R){T.data("item-id",Q);T.data("item-name",S.attributes["data-item-name"].value)}P.push(Q)});return P};LI.RelationshipTag.prototype.generateCurrentlyAppliedTags=function(){this.currentlyAppliedTags=this.getSelectedTags().join(",")};LI.RelationshipTag.prototype.onApplyTagsClicked=function(){var O=[],N=[],P=this.$tagMenu.find('input[type="checkbox"]');P.each(function(){var Q=$(this).closest("li");if($(this).prop("checked")){O.push(Q.data("item-id"))}else{N.push(Q.data("item-id"))}});this.applyTags(O,N)};LI.RelationshipTag.prototype.apiApplyTags=function(P,O,N){return $.ajax({url:String.formatWithUriEscape("/contacts/api/contacts/{0}/tags/",P),data:JSON.stringify({tag_ids:O,untag_ids:N}),type:"POST",cache:false})};LI.RelationshipTag.prototype.applyTags=function(O,N){var P=this.getContactId();c.showProgressIndicator(this.$tagMenu);if(O.length){this.apiApplyTags(P,O,N).done($.proxy(this.handleAppliedTags,this,O,N))}else{if(N.length){this.removeTags(N)}}};LI.RelationshipTag.prototype.handleAppliedTags=function(O,N){this.addHeaderTags(O);if(N.length){this.removeTags(N)}else{this.$applyAction.hide();c.hideProgressIndicator(this.$tagMenu);c.showSuccess("Your tag selection has been applied.");this.closeTagMenu();this.generateCurrentlyAppliedTags()}};LI.RelationshipTag.prototype.removeTags=function(O){var R=this.getContactId(),N=this.$applyAction,Q=this.$tagMenu,P=this;this.contactTags.remove(R,O).done(function(){N.hide();c.showSuccess("Your tag selection has been applied.");P.removeHeaderTags(O);c.hideProgressIndicator(Q);P.generateCurrentlyAppliedTags();P.closeTagMenu()}).fail(c.showGlobalError)};LI.RelationshipTag.prototype.onSelectTagMenuItemChecked=function(O,N){if(N&&N.type==="option"){this.toggleNewTagForm(false);this.$applyAction.toggle((this.currentlyAppliedTags!==this.getSelectedTags().join(",")))}};LI.RelationshipTag.prototype.onSelectTagMenuItemClicked=function(R,O){if(O.id==="new"){return}var Q=O.id,P=O.text,N;switch(Q){case"newTagLink":this.addNewTag();break;case"manage":this.manageTags();break;default:if(O.type!=="setting"){N=$('[id="relationship-tag-item-'+Q+'"]');if(N.prop("checked")){this.unTag(Q)}else{c.showProgressIndicator(this.$el);this.applyTag(P,Q)}}break}};LI.RelationshipTag.prototype.addNewTag=function(){this.$applyAction.hide();this.toggleNewTagForm(true)};LI.RelationshipTag.prototype.saveNewTag=function(){var O=this.$newTagField.val(),P=this.$newTagField.parent(),N=this;if(O.trim().length===0||O==="New tag"){c.showGlobalError("Please enter a tag name");this.$newTagField.focus();return}c.showProgressIndicator(this.$el);Connected.API.Tags.create(O).done($.proxy(this.applyTag,this,O)).fail(function(Q){c.hideProgressIndicator(N.$el);c.showGlobalError(Connected.Utils.encodeHTML(Q))})};LI.RelationshipTag.prototype.applyTag=function(P,Q){var O=this,R=this.getContactId(),N=this.$newTagForm;this.apiApplyTags(R,[Q],[]).done(function(){c.showSuccess("Your tag has been applied.");$('[id="relationship-tag-item-'+Q+'"]').prop("checked",true);O.closeTagMenu();O.toggleNewTagForm(false);window.TagManagerBroadcaster.trigger("tag.added",{id:Q,name:P})}).fail(c.showGlobalError)};LI.RelationshipTag.prototype.unTag=function(O){var N=this,P=this.$tagMenu,Q=this.getContactId();c.showProgressIndicator(P);this.contactTags.remove(Q,[O]).done(function(){c.showSuccess("Your tag has been removed.");$('[id="relationship-tag-item-'+O+'"]').prop("checked",false);c.hideProgressIndicator(P);N.closeTagMenu();N.addHeaderTags(N.getSelectedTags());N.generateCurrentlyAppliedTags()}).fail(c.showGlobalError)};LI.RelationshipTag.prototype.toggleNewTagForm=function(N){this.$newTagLink.toggleClass("hidden",N);this.$newTagForm.toggleClass("no-visibility",!N);if(N){this.$newTagField.focus()}else{c.hideProgressIndicator(this.$el);this.$newTagField.val("").blur()}};LI.RelationshipTag.prototype.manageTags=function(){this.showManageTagsDialog()};LI.RelationshipTag.prototype.showManageTagsDialog=function(){var N=$("#manageTagsDialog");if(N.length){N.remove()}this.fetch().done($.proxy(this.handleFetch,this))};LI.RelationshipTag.prototype.handleFetch=function(O){this.$relationshipContainer.append(O);var N=$("#manageTagsDialog");if(N.length){LI.Controls.parseFragment(N[0]);N.addClass("manage-tags-dialog");new UIControls.Dialog(N,{title:"Manage Tags"}).open()}};LI.RelationshipTag.prototype.fetch=function(){var N=$.Deferred();function O(P){N.resolve(P)}$.ajax({url:this.url,type:"GET",cache:false,success:O});return N.promise()}}());(function(){var g="/contacts";var b={GET:"GET",POST:"POST",PUT:"PUT",DELETE:"DELETE"};$(document).ajaxSend(function(r,u,q){function t(w){var y=document.location.host,z=document.location.protocol,x="//"+y,v=z+x;return(w===v||w.slice(0,v.length+1)===v+"/")||(w===x||w.slice(0,x.length+1)===x+"/")||!(/^(\/\/|http:|https:).*/.test(w))}function s(v){return(/^(GET|HEAD|OPTIONS|TRACE)$/.test(v))}if(!s(q.type)&&t(q.url)){var p=(LI.readCookie("JSESSIONID")||"").replace(/"/g,"");u.setRequestHeader("X_CSRF_TOKEN",p)}});var d=function(){this.url=null;this.method=b.GET;this.urlParams={source:"profile"}};window.Relationship=d;d.prototype.invokeService=function(q,s,r){var p=$.Deferred();q=g+q;function t(u){if(u.status==="success"){p.resolve(u)}else{p.reject(u.details||u.status_details||"An unspecified error occurred")}}$.ajax({url:q,type:r||b.GET,data:s,cache:false,success:t});return p.promise()};d.prototype.add=function(){};d.prototype.remove=function(){};d.prototype.update=function(){};d.prototype.getJSONString=function(p){return JSON.stringify(p)};d.prototype.getUnsaveUrl=function(p){return"/api/contacts/"+p+"/"};d.prototype.unsaveFromContact=function(p){return this.invokeService(this.getUnsaveUrl(p),"",b.DELETE)};var c=function(){d.call(this);this.url="/notes/";this.method=b.POST};window.RelationshipNote=c;c.prototype=new d();c.prototype.constructor=c;c.prototype.buildDeleteUrl=function(q,p){return"/api/contacts/"+q+this.url+p+"/?"+$.param(this.urlParams)+"&method=delete"};c.prototype.buildDeleteSourceContactNoteUrl=function(p){return"/api/contacts/"+p+this.url+"?"+$.param(this.urlParams)+"&method=delete"};c.prototype.buildUpdateUrl=function(q,p){return"/api/contacts/"+q+this.url+p+"/?"+$.param(this.urlParams)+"&method=PUT"};c.prototype.buildUrl=function(p){return"/api/contacts/"+p+this.url+"?"+$.param(this.urlParams)};c.prototype.add=function(p,q){return this.invokeService(this.buildUrl(p),this.getJSONString({contact_id:p,text:q}),this.method)};c.prototype.update=function(q,p,r){return this.invokeService(this.buildUpdateUrl(q,p),this.getJSONString({contact_id:q,text:r}),this.method)};c.prototype.remove=function(q,p){return this.invokeService(this.buildDeleteUrl(q,p),{},this.method)};c.prototype.removeSourceContactNote=function(q,p){return this.invokeService(this.buildDeleteSourceContactNoteUrl(q),this.getJSONString({source_contact_id:p}),this.method)};var h=function(){d.call(this);this.url="/reminders/"};window.RelationshipReminder=h;h.prototype=new d();h.prototype.constructor=h;h.prototype.buildDeleteUrl=function(q,p){return"/api/contacts/"+q+this.url+p+"/?"+$.param(this.urlParams)};h.prototype.buildUpdateUrl=function(q,p){return"/api/contacts/"+q+this.url+p+"/?"+$.param(this.urlParams)+"&method=PUT"};h.prototype.buildUrl=function(p){return"/api/contacts/"+p+this.url+"?"+$.param(this.urlParams)};h.prototype.add=function(p,q){return this.invokeService(this.buildUrl(p),this.getJSONString(q),b.POST)};h.prototype.update=function(q,p,r){return this.invokeService(this.buildUpdateUrl(q,p),this.getJSONString(r),b.PUT)};h.prototype.remove=function(q,p){return this.invokeService(this.buildDeleteUrl(q,p),{},b.DELETE)};var i=function(){d.call(this);this.url="/api/contacts/";this.method=b.POST;this.urlParams.method=b.PUT};window.RelationshipHowYouMet=i;i.prototype=new d();i.prototype.constructor=i;i.prototype.buildUrl=function(p){return this.url+p+"/?"+$.param(this.urlParams)};i.prototype.update=function(r,p,q){return this.invokeService(this.buildUrl(r),this.getJSONString({how_we_met:{intro_contact_id:q,description:p}}),this.method)};i.prototype.add=function(q,p){return this.update(q,p)};var k=function(){d.call(this);this.url="/tags/";this.method=b.POST};window.RelationshipContactTags=k;k.prototype=new d();k.prototype.constructor=k;k.prototype.buildDeleteUrl=function(r,q){var p;if(q instanceof Array){p=q.join(",")}else{p=q}return"/api/contacts/"+r+this.url+p+"/?"+$.param(this.urlParams)+"&method=delete"};k.prototype.buildUrl=function(p){return"/api/contacts/"+p+this.url};k.prototype.add=function(q,p){return this.invokeService(this.buildUrl(q),this.getJSONString({tag_id:p}),this.method)};k.prototype.remove=function(q,p){return this.invokeService(this.buildDeleteUrl(q,p),{},this.method)};var n=function(){d.call(this);this.method=b.GET;this.url="/services/get_search_contacts/";this.data=[];this.loaded=false};window.RelationshipContacts=n;n.prototype=new d();n.prototype.constructor=n;n.prototype.fetch=function(){this.$fetchedContacts=this.$fetchedContacts||this.invokeService(this.url).done($.proxy(this.handleFetch,this));return this.$fetchedContacts};n.prototype.handleFetch=function(p){if(p&&p.status==="success"){this.data=p.contacts;this.loaded=true}};n.prototype.isLoaded=function(){return this.loaded};n.prototype.getContacts=function(){return this.data};n.getInstance=function(){if(!n._instance){n._instance=new n()}return n._instance};var a=function(p){d.call(this);this.url="/api/contacts/";this.method=b.POST;this.urlParams={};this.name=p};window.ContactField=a;a.prototype=new d();a.prototype.constructor=a;a.prototype.buildUrl=function(p){return this.url+p+"/"+this.name+"/?"+$.param(this.urlParams)};a.prototype.buildDeleteUrl=function(p,q){return this.url+p+"/"+this.name+"/"+q+"/?method=delete"};a.prototype.add=function(p,q){return this.invokeService(this.buildUrl(p),this.getJSONString(q),this.method)};a.prototype.remove=function(p,q){return this.invokeService(this.buildDeleteUrl(p,q),"",this.method)};var l=function(p){a.call(this,p);this.method="PUT"};window.EmailField=l;l.prototype=new a();l.prototype.constructor=l;l.prototype.buildUrl=function(p){return this.url+p+"/?"+$.param(this.urlParams)};l.prototype.buildDeleteUrl=function(p){return this.buildUrl(p)};l.prototype.remove=function(p,q){return this.invokeService(this.buildUrl(p),this.getJSONString(q),this.method)};var e=function(p){a.call(this,p);this.method=b.PUT};window.BirthdayField=e;e.prototype=new a();e.prototype.constructor=e;e.prototype.buildUrl=function(p){return this.url+p+"/?"+$.param(this.urlParams)};var m=function(p){a.call(this,p);this.method=b.PUT};window.IMField=m;m.prototype=new a();m.prototype.constructor=m;m.prototype.buildDeleteUrl=function(p){return this.buildUrl(p)};m.prototype.remove=function(p,q){return this.invokeService(this.buildUrl(p),this.getJSONString(q),this.method)};m.prototype.buildUrl=function(p){return this.url+p+"/?"+$.param(this.urlParams)};var o=function(){a.call(this);this.method=b.POST;this.urlParams={method:"put"}};window.NameField=o;o.prototype=new a();o.prototype.constructor=o;o.prototype.buildUrl=function(p){return this.url+p+"/?"+$.param(this.urlParams)};var f=function(){a.call(this);this.method=b.POST;this.urlParams={method:"put"}};window.CompanyField=f;f.prototype=new a();f.prototype.constructor=f;f.prototype.buildUrl=function(p){return this.url+p+"/?"+$.param(this.urlParams)};f.prototype.displayName=function(q,p){return((q)?q:"")+((q&&p&&p.name)?" at ":"")+((p&&p.name)?p.name:"")};var j=function(p){a.call(this,p);this.method=b.POST;this.urlParams={method:"put"}};window.LocationField=j;j.prototype=new a();j.prototype.constructor=j;j.prototype.buildUrl=function(p){return this.url+p+"/?"+$.param(this.urlParams)}}());$(function(){LI.define("RelationshipContactInfo");LI.define("RelationshipContactInfoHelpers");var m="/static",g="relationship",i="success",a="address",b="contact-fields",h="contact-field-item",p="contact-edit-form",n=5000,j=Contacts.Constants.URL_PROTOCOL_REGEX,l=Contacts.Constants.URL_REGEX,f=Contacts.Constants.EMAIL_REGEX,e=$(document.body),k=27,o=13,q={NAME:"name",EMAILS:"emails",ADDRESSES:"addresses",BIRTHDAY:"birthday",PHONE_NUMBERS:"phone_numbers",SITES:"sites",IM:"ims",COMPANY:"company",TITLE:"title",LOCATION:"location"};var d=function(){};d.getRelationshipModule=function(){return LI.Controls.getControl($("#"+g)[0],"RelationshipLoader")};d.closeOpenHoverForms=function(){$("#"+g).find(".contact-info-table").each(function(){$(this).find("tr").css("z-index",0);$(this).find(".hover-form").remove()})};LI.RelationshipContactInfoHelpers.checkForEmptyContactInfoRegions=function(){var r=$("#contact-container");var u=2;var t=true;function s(v){if(v.find("tr.no-contact-info-data").length===v.find("tr").length){return true}return false}$.each(r.find(".contact-info-table, .contact-internet-presence-table"),function(){var v=$(this);if(s(v)){v.hide();if(v.hasClass("contact-internet-presence-table")){t=false}else{if(v.hasClass("contact-info-table")){u-=1}}}});this.hideEmptyFields();r.find(".contact-info-websites-separator").css("display",(u>0&&t)?"block":"none")};LI.RelationshipContactInfoHelpers.hideEmptyFields=function(s){var r=$("#contact-container");r.find("tr").each(function(){var u=$(this),t=u.find(".contact-info-text");if(!t.text()){u.addClass("no-contact-info-data")}})};LI.RelationshipContactInfoHelpers.getNumberSegment=function(t,s){var r=$.trim(t).match(new RegExp("\\d{1,"+(s||"")+"}"));if(r===null){return""}else{return r[0]}};LI.RelationshipContactInfoHelpers.transformSourceNameToIcon=function(r){return r.toLowerCase().replace(/\s+/mg,"_").replace(/!/g,"")};LI.RelationshipContactInfoHelpers.cleanAndFilterContactSources=function(s){var r=[];for(var t=0;t<s.length;t++){r.push({name:s[t],icon:LI.RelationshipContactInfoHelpers.transformSourceNameToIcon(s[t])})}return r};LI.RelationshipContactInfo=function(s,r){r=r||{};this.$el=$(s);this.$contactActions=this.$el.find(".contact-actions");this.contactId=r.contactId;m=r.staticUrl;this.bindEvents()};LI.RelationshipContactInfo.prototype.bindEvents=function(){this.$contactActions.on("click.{0}".format(this._eventNamespace),$.proxy(this.toggleEditMode,this));this.$el.on("click.{0}".format(this._eventNamespace),$.proxy(this.handleClick,this))};LI.RelationshipContactInfo.prototype.toggleEditMode=function(s){var r=$(s.target);if(r.hasClass("edit-section")||r.hasClass("edit")){if(this.$el.hasClass("edit-mode")){d.closeOpenHoverForms();LI.RelationshipContactInfoHelpers.checkForEmptyContactInfoRegions()}else{this.$el.find(".contact-info-table, .contact-internet-presence-table, .contact-info-websites-separator").show()}this.$el.toggleClass("edit-mode")}};LI.RelationshipContactInfo.prototype.handleClick=function(s){var u=$(s.target),r,t;if(u.closest(".edit-tools").length){d.closeOpenHoverForms();r=u.closest(".edit-tools");t=r.data("li-type");this.editContactField(t)}};LI.RelationshipContactInfo.prototype.editContactField=function(y){var v=d.getRelationshipModule(),t=v&&v.getContactInfo(),A=t&&t.contact_data,z=$("#relationship-"+y),r="edit-"+y,w,s,x;if(y==="birthday"){w=this.getBirthday(A)}else{w=A}if(w){switch(y){case"emails":x=w.emails;break;case"phone-numbers":x=w.phone_numbers;break;case"sites":x=w.sites;break;case"im":x=w.ims;break;case"addresses":x=w.addresses;break;default:x=[];break}for(var u=0;u<x.length;u++){s=x[u];if(s.source&&typeof s.source!=="object"){s.source={name:s.source,icon:LI.RelationshipContactInfoHelpers.transformSourceNameToIcon(s.source)}}}z.closest("tr").css("z-index",100);dust.render(r,w,function(C,B){z.append(B);z.find("input:first").focus();LI.Controls.parseFragment(z[0])})}};LI.RelationshipContactInfo.prototype.getBirthday=function(u){var t=d.getRelationshipModule(),v=t&&t.getContactField(q.BIRTHDAY),s={month:"",date:"",year:"",id:u.id},r;if(v){r=v.split("/");if(r.length>0){s.month=r[0]}if(r.length>1){s.date=r[1]}if(r.length>2){s.year=r[2]}}return s};var c=window.ContactEditForm=function(s,r){if(arguments.length===0){return}r=r||{};this._validationFields={};this.$el=$(s).closest(".edit-form");this._eventNamespace="_"+(new Date().getTime()).toString();this.$actions=this.$el.find(".actions, .icon.edit");this.$progressIndicator=this.$el.find(".progress-indicator");this.contactId=r.id;this.hadData=r.hadData||false;this.bindEvents()};c.prototype._addFieldForValidation=function(s){this._addFieldForValidation.counter=this._addFieldForValidation.counter?this._addFieldForValidation.counter+=1:1;s=s.jquery?s:$(field);var t="id-"+this._addFieldForValidation.counter.toString();var r=s[0].tagName.toLowerCase();s.data("edit-form-id",t);this._validationFields[t]=s;if("input|password|textarea".indexOf(r)>-1){s.on("keyup."+p,$.proxy(function(){this.checkFormValidity()},this))}else{if(r==="select"){s.on("change."+p,$.proxy(function(){this.checkFormValidity()},this))}}};c.prototype.addFieldsForValidation=function(r){$.each(r,$.proxy(function(s,t){this._addFieldForValidation($(t))},this));this.checkFormValidity();return r};c.prototype._removeFieldForValidation=function(r){r.off("."+p);delete this._validationFields[r.data("editFormId")]};c.prototype.removeFieldsForValidation=function(r){$.each(r,$.proxy(function(s,t){this._removeFieldForValidation($(t))},this));return r};c.prototype.removeAllFieldsForValidation=function(){$.each(this._validationFields,$.proxy(function(r,s){this._removeFieldForValidation(s)},this))};c.prototype.setValidState=function(){this.$el.addClass("is-valid");this.$el.find(".save-action").removeAttr("disabled")};c.prototype.setInvalidState=function(){this.$el.addClass("is-invalid");this.$el.find(".save-action").attr("disabled","disabled")};c.prototype.checkFormValidity=function(){var r=true;$.each(this._validationFields,$.proxy(function(s,t){if(this.getValueForField(t)===""&&!this.hadData){r=false}},this));if(!r){this.setInvalidState()}else{this.setValidState()}return r};c.prototype.isFormValid=function(){return this.checkFormValidity()};c.prototype.getValueForField=function(x){var u=$(x);var t="";if(!u){return t}try{var r=this.$el.find('label[for="'+u.attr("id")+'"]');if(u[0].tagName.toLowerCase()!=="input"||!r){return u.val().trim()}var s=LI.Controls.getControl(r[0],"GhostLabel");if(!s){return t}var v=u.val().trim();if(s.getLabel()===v){return t}else{return v}}catch(w){return t}};c.prototype.triggerClickSave=function(){if(this.isFormValid()){this.$el.find(".save-action").trigger("click")}};c.prototype.bindEvents=function(){this.$el.on("click.{0}".format(this._eventNamespace),$.proxy(this.handleClick,this));setTimeout($.proxy(function(){e.on("click.{0}".format(this._eventNamespace),$.proxy(this.handleAction,this))},this),0);this.$el.on("keyup."+p,$.proxy(function(r){if(r.keyCode===k){d.closeOpenHoverForms()}else{if(r.keyCode===o){this.triggerClickSave()}}},this));e.on("keyup."+p,$.proxy(function(r){if(r.keyCode===k){d.closeOpenHoverForms()}},this))};c.prototype.unbindEvents=function(){var r=".{0}".format(this._eventNamespace);e.off(r);this.$actions.off(r);this.$el.off(r)};c.prototype.isDOMEventOutsideEditForm=function(r){return $(r.target).parents(".edit-form").length===0};c.prototype.DOMEventShouldRemoveEditForm=function(s){var r=$(s.target);return r.is(".icon.edit")||this.isDOMEventOutsideEditForm(s)};c.prototype.hideContactInfoRow=function(){this.$el.closest("tr").addClass("no-contact-info-data")};c.prototype.hideContactInfoSeparator=function(){this.$el.find(".contact-info-separator").hide()};c.prototype.handleClick=function(r){};c.prototype.handleAction=function(r){};c.prototype.handleSave=function(){this.$progressIndicator.hide();this.removeEditForm()};c.prototype.handleError=function(r){this.$progressIndicator.hide();LI.injectAlert(r,"error",null,false,true);window.setTimeout(function(){LI.removeAlert()},n)};c.prototype.removeEditForm=function(){this.unbindEvents();this.removeAllFieldsForValidation();this.$el.remove()};LI.define("ContactEmailForm");LI.ContactEmailForm=function(s,r){r=r||{};c.call(this,s,r);this.$emailAddress=this.$el.find(".email-address");this.addFieldsForValidation(this.$emailAddress);this.field=new EmailField(q.EMAILS)};LI.ContactEmailForm.prototype=new c();LI.ContactEmailForm.prototype.constructor=LI.ContactEmailForm;LI.ContactEmailForm.prototype.handleClick=function(r){var v=$(r.target),t,s,u,w;if(v.closest(".remove").length){t=v.closest("li");s=t.data("li-value");u=t.data("li-index");this.$progressIndicator.show();w={email:{remove:s}};this.field.remove(this.contactId,w).done($.proxy(this.handleDelete,this,s,u)).fail($.proxy(this.handleError,this))}};LI.ContactEmailForm.prototype.handleAction=function(s){var r=$(s.target),t;if(this.DOMEventShouldRemoveEditForm(s)){this.removeEditForm()}else{if(r.hasClass("save-action")&&this.isFormValid()){this.$progressIndicator.show();t={email:{add:this.getValueForField(this.$emailAddress).toLowerCase()}};this.field.add(this.contactId,t).done($.proxy(this.handleSave,this)).fail($.proxy(this.handleError,this))}}};LI.ContactEmailForm.prototype.checkFormValidity=function(){var r=f.test(this.getValueForField(this.$emailAddress));if(!r){this.setInvalidState()}else{this.setValidState()}return r};LI.ContactEmailForm.prototype.handleDelete=function(t,v,s){if(s.status===i){var w=d.getRelationshipModule(),x;$("#relationship-email-edit-item-"+v).remove();$("#relationship-email-item-"+v).remove();if(w){x=w.getContactField("emails")||[];for(var u=0,r=x.length;u<r;u++){if(x[u]&&(x[u].email===t||x[u].added_email===t)){x.splice(u,1);break}}if(x.length===0){this.hideContactInfoSeparator();this.hideContactInfoRow()}}this.$progressIndicator.hide()}};LI.ContactEmailForm.prototype.handleSave=function(r){if(r.status===i){var u=d.getRelationshipModule(),t=r.added_email,w=[],v=$("#relationship-emails-view"),s=v.find("ul");if(u){u.updateContactInfo(q.EMAILS,{email:t,source:r.source});w=u.getContactField(q.EMAILS);dust.render(b,{type:"emails",list:w},function(y,x){s.html(x);v.closest("tr").removeClass("no-contact-info-data")})}this.$progressIndicator.hide();this.removeEditForm()}};LI.define("ContactBirthdayForm");LI.ContactBirthdayForm=function(s,r){r=r||{};c.call(this,s,r);this.$month=this.$el.find(".month");this.$date=this.$el.find(".date");this.$year=this.$el.find(".year");this.addFieldsForValidation([this.$month,this.$date]);this.field=new BirthdayField(q.BIRTHDAY)};LI.ContactBirthdayForm.prototype=new c();LI.ContactBirthdayForm.prototype.constructor=LI.ContactBirthdayForm;LI.ContactBirthdayForm.prototype.handleAction=function(s){var r=$(s.target);if(this.DOMEventShouldRemoveEditForm(s)){this.removeEditForm()}else{if(r.hasClass("save-action")&&this.isFormValid()){this.$progressIndicator.show();this.saveBirthday()}}};LI.ContactBirthdayForm.prototype.validateBirthday=function(x,s,w){var y=/^\d{1,2}$/;var v=/^\d{4}$/;if(this.hadData&&(x+s+w)===""){return true}function u(){return y.test(x)&&window.parseInt(x,10)<=12}function r(){return y.test(s)&&window.parseInt(s,10)<=31}function t(){if(w.length>0){return v.test(w)}return true}return(u()&&r()&&t())};LI.ContactBirthdayForm.prototype.saveBirthday=function(){var t=this.getValueForField(this.$month);var r=this.getValueForField(this.$date);var s=this.getValueForField(this.$year);if(!this.validateBirthday(t,r,s)){return this.handleError("Please enter a valid birthday")}var u={birthday:{date:(t+r+s)!==""?t+"/"+r+(s?"/"+s:""):""}};this.field.add(this.contactId,u).done($.proxy(this.handleSave,this)).fail($.proxy(this.handleError,this))};LI.ContactBirthdayForm.prototype.handleSave=function(r){if(r.status===i){var s=d.getRelationshipModule(),t=$("#relationship-birthday-view");if(s){s.updateContactInfo(q.BIRTHDAY,r.birthday)}t.text(r.birthday);t.closest("tr").removeClass("no-contact-info-data");this.$progressIndicator.hide();this.removeEditForm()}};LI.define("ContactAddressForm");LI.ContactAddressForm=function(s,r){r=r||{};c.call(this,s,r);this.$address1=this.$el.find(".street-address1");this.$address2=this.$el.find(".street-address2");this.$city=this.$el.find(".city");this.$state=this.$el.find(".state");this.$zip=this.$el.find(".zipcode");this.$type=this.$el.find(".address-type");this.addFieldsForValidation(this.$address1);this.field=new ContactField(q.ADDRESSES)};LI.ContactAddressForm.prototype=new c();LI.ContactAddressForm.prototype.constructor=LI.ContactAddressForm;LI.ContactAddressForm.prototype.handleAction=function(s){var r=$(s.target);if(this.DOMEventShouldRemoveEditForm(s)){this.removeEditForm()}else{if(r.hasClass("save-action")&&this.isFormValid()){this.$progressIndicator.show();this.saveAddress()}}};LI.ContactAddressForm.prototype.handleClick=function(r){var s=$(r.target),t;if(s.closest(".remove").length){t=s.closest("li").data("li-value");this.$progressIndicator.show();this.field.remove(this.contactId,t).done($.proxy(this.handleDelete,this,t)).fail($.proxy(this.handleError,this))}};LI.ContactAddressForm.prototype.handleDelete=function(w,s){if(s.status===i){var v=d.getRelationshipModule(),u;if(v){u=v.getContactField(q.ADDRESSES)||[];$("#relationship-edit-address-"+w).remove();$("#relationship-address-"+w).remove();for(var t=0,r=u.length;t<r;t++){if(u[t]&&(u[t].id===w||u[t].address_id===w)){u.splice(t,1);break}}if(u.length===0){this.hideContactInfoSeparator();this.hideContactInfoRow()}}this.$progressIndicator.hide()}};LI.ContactAddressForm.prototype.checkFormValidity=function(){var r=this.getValueForField(this.$address1)!=="";if(!r){this.setInvalidState()}else{this.setValidState()}return r};LI.ContactAddressForm.prototype.saveAddress=function(){var r={address1:this.getValueForField(this.$address1),address2:this.getValueForField(this.$address2),city:this.getValueForField(this.$city),state:this.getValueForField(this.$state),zip:this.getValueForField(this.$zip),type:this.getValueForField(this.$type)};this.field.add(this.contactId,r).done($.proxy(this.handleSave,this))};LI.ContactAddressForm.prototype.handleSave=function(r){if(r.status===i){var u=d.getRelationshipModule(),v=$("#relationship-addresses-view"),t=v.find("ul"),s=v.parents("tr");if(u){u.updateContactInfo(q.ADDRESSES,r)}dust.render(h,{type:"address",item:r},function(x,w){t.append(w);s.removeClass("no-contact-info-data")});this.$progressIndicator.hide();this.removeEditForm()}};LI.define("ContactPhoneNumberForm");LI.ContactPhoneNumberForm=function(s,r){r=r||{};c.call(this,s,r);this.$phoneNumber=this.$el.find(".phone-number");this.$type=this.$el.find(".phone-type");this.addFieldsForValidation(this.$phoneNumber);this.field=new ContactField(q.PHONE_NUMBERS)};LI.ContactPhoneNumberForm.prototype=new c();LI.ContactPhoneNumberForm.prototype.constructor=LI.ContactPhoneNumberForm;LI.ContactPhoneNumberForm.prototype.handleAction=function(s){var r=$(s.target);if(this.DOMEventShouldRemoveEditForm(s)){this.removeEditForm()}else{if(r.hasClass("save-action")&&this.isFormValid()){this.$progressIndicator.show();this.savePhoneNumber()}}};LI.ContactPhoneNumberForm.prototype.handleClick=function(r){var s=$(r.target),t;if(s.closest(".remove").length){t=s.closest("li").data("li-value");this.$progressIndicator.show();this.field.remove(this.contactId,t).done($.proxy(this.handleDelete,this,t)).fail($.proxy(this.handleError,this))}};LI.ContactPhoneNumberForm.prototype.handleDelete=function(w,t){if(t.status===i){var v=d.getRelationshipModule(),s;if(v){s=v.getContactField(q.PHONE_NUMBERS)||[];$("#relationship-edit-phone-number-"+w).remove();$("#relationship-phone-number-"+w).remove();for(var u=0,r=s.length;u<r;u++){if(s[u]&&(s[u].id===w||s[u].phone_number_id===w)){s.splice(u,1);break}}if(s.length===0){this.hideContactInfoSeparator();this.hideContactInfoRow()}}this.$progressIndicator.hide()}};LI.ContactPhoneNumberForm.prototype.checkFormValidity=function(){var r=this.getValueForField(this.$phoneNumber).match(/\d+/g);var s=(r!==null);if(!s){this.setInvalidState()}else{this.setValidState()}return s};LI.ContactPhoneNumberForm.prototype.savePhoneNumber=function(){var r={number:this.getValueForField(this.$phoneNumber),type:this.getValueForField(this.$type)};this.field.add(this.contactId,r).done($.proxy(this.handleSave,this)).fail($.proxy(this.handleError,this))};LI.ContactPhoneNumberForm.prototype.handleSave=function(r){if(r.status===i){var u=d.getRelationshipModule(),v=$("#relationship-phone-numbers-view"),t=v.parents("tr"),s=v.find("ul");if(u){u.updateContactInfo(q.PHONE_NUMBERS,r)}dust.render(h,{type:"phone_number",item:r},function(x,w){s.append(w);t.removeClass("no-contact-info-data")});c.prototype.handleSave.call(this)}};LI.define("ContactWebsiteForm");LI.ContactWebsiteForm=function(s,r){r=r||{};c.call(this,s,r);this.$websiteUrl=this.$el.find(".site-url");this.$title=this.$el.find(".site-title");this.addFieldsForValidation(this.$websiteUrl);this.field=new ContactField(q.SITES)};LI.ContactWebsiteForm.prototype=new c();LI.ContactWebsiteForm.prototype.constructor=LI.ContactWebsiteForm;LI.ContactWebsiteForm.prototype.handleAction=function(s){var r=$(s.target);if(this.DOMEventShouldRemoveEditForm(s)){this.removeEditForm()}else{if(r.hasClass("save-action")&&this.isFormValid()){this.$progressIndicator.show();this.saveWebsite()}}};LI.ContactWebsiteForm.prototype.handleClick=function(r){var s=$(r.target),t;if(s.closest(".remove").length){t=s.closest("li").data("li-value");this.$progressIndicator.show();this.field.remove(this.contactId,t).done($.proxy(this.handleDelete,this,t)).fail($.proxy(this.handleError,this))}};LI.ContactWebsiteForm.prototype.handleDelete=function(w,s){if(s.status===i){var u=d.getRelationshipModule(),v;if(u){v=u.getContactField(q.SITES)||[];$("#relationship-edit-site-"+w).remove();$("#relationship-site-"+w).remove();for(var t=0,r=v.length;t<r;t++){if(v[t]&&v[t].site_id===w){v.splice(t,1);break}}if(v.length===0){this.hideContactInfoSeparator();this.hideContactInfoRow()}}this.$progressIndicator.hide()}};LI.ContactWebsiteForm.prototype.checkFormValidity=function(){var r=this.getValueForField(this.$websiteUrl);if(!j.test(r)){r="http://"+r}var s=l.test(r);if(!s){this.setInvalidState()}else{this.setValidState()}return s};LI.ContactWebsiteForm.prototype.saveWebsite=function(){var r={url:this.getValueForField(this.$websiteUrl),name:this.getValueForField(this.$title)};this.field.add(this.contactId,r).done($.proxy(this.handleSave,this)).fail($.proxy(this.handleError,this))};LI.ContactWebsiteForm.prototype.handleSave=function(r){if(r.status===i){var u=d.getRelationshipModule(),v=$("#relationship-sites-view"),t=v.find("ul"),s=v.parents("tr");if(u){u.updateContactInfo(q.SITES,r)}dust.render(h,{type:"site",item:r},function(x,w){t.append(w);s.removeClass("no-contact-info-data")});c.prototype.handleSave.call(this)}};LI.define("ContactIMForm");LI.ContactIMForm=function(s,r){r=r||{};c.call(this,s,r);this.$im=this.$el.find(".im-id");this.$type=this.$el.find(".im-type");this.addFieldsForValidation(this.$im);this.field=new IMField(q.IM)};LI.ContactIMForm.prototype=new c();LI.ContactIMForm.prototype.constructor=LI.ContactIMForm;LI.ContactIMForm.prototype.handleAction=function(s){var r=$(s.target);if(this.DOMEventShouldRemoveEditForm(s)){this.removeEditForm()}else{if(r.hasClass("save-action")&&this.isFormValid()){this.$progressIndicator.show();this.saveIM()}}};LI.ContactIMForm.prototype.handleClick=function(r){var u=$(r.target),w,v,t,s;if(u.closest(".remove").length){s=u.closest("li");w=s.data("li-value");t=s.data("li-type");this.$progressIndicator.show();v={im:{remove:w,type:t}};this.field.remove(this.contactId,v).done($.proxy(this.handleDelete,this,w,s)).fail($.proxy(this.handleError,this))}};LI.ContactIMForm.prototype.handleDelete=function(r,x,s){if(s.status===i){var t=d.getRelationshipModule(),z=$("#relationship-im-view"),v=z.find("ul"),y;if(t){y=t.getContactField(q.IM)||[];x.remove();$("#relationship-im-"+r).remove();for(var u=0,w=y.length;u<w;u++){if(y[u]&&(y[u].name===r||y[u].added_im===r)){y.splice(u,1);break}}if(y.length===0){this.hideContactInfoSeparator();this.hideContactInfoRow()}dust.render(b,{type:"ims",list:y},function(B,A){v.html(A)})}this.$progressIndicator.hide()}};LI.ContactIMForm.prototype.saveIM=function(){var r={im:{add:this.getValueForField(this.$im),type:this.getValueForField(this.$type)}};this.field.add(this.contactId,r).done($.proxy(this.handleSave,this)).fail($.proxy(this.handleError,this))};LI.ContactIMForm.prototype.handleSave=function(r){if(r.status===i){var u=d.getRelationshipModule(),v=$("#relationship-im-view"),t=v.find("ul"),s=v.parents("tr");if(u){u.updateContactInfo(q.IM,r)}dust.render(h,{type:"im",item:r},function(x,w){t.append(w);s.removeClass("no-contact-info-data")});c.prototype.handleSave.call(this)}};LI.define("ContactNameForm");LI.ContactNameForm=function(s,r){r=r||{};c.call(this,s,r);this.$name=this.$el.find(".name-field");this.addFieldsForValidation(this.$name);this.field=new NameField()};LI.ContactNameForm.prototype=new c();LI.ContactNameForm.prototype.constructor=LI.ContactNameForm;LI.ContactNameForm.prototype.handleAction=function(s){var r=$(s.target);if(this.DOMEventShouldRemoveEditForm(s)){this.removeEditForm()}else{if(r.hasClass("save-action")&&this.isFormValid()){this.$progressIndicator.show();this.saveName()}}};LI.ContactNameForm.prototype.saveName=function(){var r=this.getValueForField(this.$name);this.field.add(this.contactId,{name:{name:r}}).done($.proxy(this.handleSave,this)).fail($.proxy(this.handleError,this))};LI.ContactNameForm.prototype.handleSave=function(r){if(r.status===i){var s=d.getRelationshipModule(),t=$("#relationship-name-view");if(s){s.updateContactInfo(q.NAME,r.name)}t.text(r.name||"");t.closest("tr").removeClass("no-contact-info-data");c.prototype.handleSave.call(this)}};LI.define("ContactCompanyForm");LI.ContactCompanyForm=function(s,r){r=r||{};c.call(this,s,r);this.$title=this.$el.find(".title-field");this.$company=this.$el.find(".company-field");this.addFieldsForValidation([this.$title,this.$company]);this.field=new CompanyField()};LI.ContactCompanyForm.prototype=new c();LI.ContactCompanyForm.prototype.constructor=LI.ContactCompanyForm;LI.ContactCompanyForm.prototype.handleAction=function(s){var r=$(s.target);if(this.DOMEventShouldRemoveEditForm(s)){this.removeEditForm()}else{if(r.hasClass("save-action")&&this.isFormValid()){this.$progressIndicator.show();this.saveName()}}};LI.ContactCompanyForm.prototype.saveName=function(){this.field.add(this.contactId,{title:{title:this.getValueForField(this.$title)},company:{company:this.getValueForField(this.$company)}}).done($.proxy(this.handleSave,this)).fail($.proxy(this.handleError,this))};LI.ContactCompanyForm.prototype.handleSave=function(r){if(r.status===i){var s=d.getRelationshipModule(),t=$("#relationship-company-view");if(s){s.updateContactInfo(q.COMPANY,r.company);s.updateContactInfo(q.TITLE,r.title)}t.text(this.field.displayName(r.title,r.company));t.closest("tr").removeClass("no-contact-info-data");c.prototype.handleSave.call(this)}};LI.define("ContactLocationForm");LI.ContactLocationForm=function(s,r){r=r||{};c.call(this,s,r);this.$location=this.$el.find(".location-field");this.addFieldsForValidation(this.$location);this.field=new LocationField()};LI.ContactLocationForm.prototype=new c();LI.ContactLocationForm.prototype.constructor=LI.ContactLocationForm;LI.ContactLocationForm.prototype.handleAction=function(s){var r=$(s.target);if(this.DOMEventShouldRemoveEditForm(s)){this.removeEditForm()}else{if(r.hasClass("save-action")&&this.isFormValid()){this.$progressIndicator.show();this.saveName()}}};LI.ContactLocationForm.prototype.saveName=function(){this.field.add(this.contactId,{location:{location:this.getValueForField(this.$location)}}).done($.proxy(this.handleSave,this)).fail($.proxy(this.handleError,this))};LI.ContactLocationForm.prototype.handleSave=function(r){if(r.status===i){var s=d.getRelationshipModule(),t=$("#relationship-location-view");if(s){s.updateContactInfo(q.LOCATION,r.location)}t.text(r.location);t.closest("tr").removeClass("no-contact-info-data");c.prototype.handleSave.call(this)}}});LI.define("ChatIn.QR2");LI.ChatIn.QR2=function(c,b){var e='<div class="relationship-wechat-qrcode">             <div class="instruction">               <p>To add <%- username %> as a WeChat contact, scan this code using WeChat.</p>             </div>             <img class="qrcode-img" src="<%= qr2Url %>" width="200" height="200" alt="WeChat QR Code"/>          </div>';var d=_.template(e),a={username:c.text(),qr2Url:b};this.$contentTemplate=$(d(a));this.dialog=new UIControls.Dialog($(null),{title:"Scan QR code"});if(!this.dialog.$el.length){this.dialog.$el=this.$contentTemplate;this.dialog.appendContent()}this.dialog.open()};